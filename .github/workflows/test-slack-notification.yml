name: Test Slack Notification
on:
  workflow_dispatch:
    inputs:
      target_date:
        description: 'ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®æ—¥ä»˜ (YYYY-MM-DD) - ç©ºæ¬„ã§æœ€æ–°'
        required: false
        type: string
      notification_type:
        description: 'ãƒ†ã‚¹ãƒˆã™ã‚‹é€šçŸ¥ã‚¿ã‚¤ãƒ—'
        required: true
        type: choice
        options:
          - 'bot_with_pdf'
          - 'webhook_with_links'
          - 'no_slide_notification'
          - 'test_all_methods'
        default: 'test_all_methods'
      test_message:
        description: 'ãƒ†ã‚¹ãƒˆè­˜åˆ¥ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸'
        required: false
        type: string
        default: 'ğŸ§ª Slacké€šçŸ¥ãƒ†ã‚¹ãƒˆ'

jobs:
  test-notification:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: Install Japanese fonts
        run: |
          sudo apt-get update
          sudo apt-get install -y fonts-noto-cjk fonts-noto-cjk-extra
          fc-cache -fv

      - name: Install Marp CLI
        run: npm install -g @marp-team/marp-cli

      - name: Determine target date
        id: target
        run: |
          if [ -n "${{ github.event.inputs.target_date }}" ]; then
            TARGET_DATE="${{ github.event.inputs.target_date }}"
          else
            TARGET_DATE=$(find . -maxdepth 1 -type d -name '[0-9][0-9][0-9][0-9]-[0-9][0-9]-[0-9][0-9]' | sort -r | head -n1 | sed 's|./||')
          fi
          
          echo "target_date=$TARGET_DATE" >> $GITHUB_OUTPUT
          echo "ğŸ¯ Target date: $TARGET_DATE"
          
          if [ -f "$TARGET_DATE/slide.md" ]; then
            echo "slide_exists=true" >> $GITHUB_OUTPUT
            echo "âœ… Found slide.md in $TARGET_DATE"
          else
            echo "slide_exists=false" >> $GITHUB_OUTPUT
            echo "âŒ slide.md not found in $TARGET_DATE"
          fi

      - name: Check Slack configuration
        id: config
        run: |
          echo "ğŸ” Checking Slack configuration..."
          
          if [ -n "${{ secrets.SLACK_BOT_TOKEN }}" ] && [ -n "${{ secrets.SLACK_REVIEW_CHANNEL }}" ]; then
            echo "bot_available=true" >> $GITHUB_OUTPUT
            echo "âœ… Bot Token configuration found"
          else
            echo "bot_available=false" >> $GITHUB_OUTPUT
            echo "âŒ Bot Token configuration missing"
          fi
          
          if [ -n "${{ secrets.SLACK_WEBHOOK_URL }}" ]; then
            echo "webhook_available=true" >> $GITHUB_OUTPUT
            echo "âœ… Webhook configuration found"
          else
            echo "webhook_available=false" >> $GITHUB_OUTPUT
            echo "âŒ Webhook configuration missing"
          fi

      - name: Generate test PDF
        if: steps.target.outputs.slide_exists == 'true' && (github.event.inputs.notification_type == 'bot_with_pdf' || github.event.inputs.notification_type == 'test_all_methods')
        run: |
          TARGET_DATE="${{ steps.target.outputs.target_date }}"
          
          echo "ğŸ“„ Generating test PDF for $TARGET_DATE..."
          
          mkdir -p test-output
          
          cd "$TARGET_DATE"
          marp "slide.md" \
            --pdf \
            --allow-local-files \
            --output "../test-output/test-$TARGET_DATE.pdf"
          cd ..
          
          PDF_SIZE=$(stat -c%s "test-output/test-$TARGET_DATE.pdf")
          echo "ğŸ“Š PDF size: $PDF_SIZE bytes"
          
          if [ $PDF_SIZE -gt 10485760 ]; then
            echo "âš ï¸ PDF size exceeds Slack limit (10MB)"
            echo "ãƒ†ã‚¹ãƒˆç”¨ã«å°ã•ãªPDFã‚’ç”Ÿæˆã—ã¾ã™..."
            
            cd "$TARGET_DATE"
            head -50 slide.md > slide_short.md
            marp "slide_short.md" \
              --pdf \
              --allow-local-files \
              --output "../test-output/test-$TARGET_DATE.pdf"
            rm slide_short.md
            cd ..
            
            NEW_SIZE=$(stat -c%s "test-output/test-$TARGET_DATE.pdf")
            echo "ğŸ“Š Shortened PDF size: $NEW_SIZE bytes"
          fi

      - name: Test Bot Token notification with PDF upload
        if: (github.event.inputs.notification_type == 'bot_with_pdf' || github.event.inputs.notification_type == 'test_all_methods') && steps.config.outputs.bot_available == 'true' && steps.target.outputs.slide_exists == 'true'
        env:
          SLACK_BOT_TOKEN: ${{ secrets.SLACK_BOT_TOKEN }}
          SLACK_CHANNEL: ${{ secrets.SLACK_REVIEW_CHANNEL }}
        run: |
          TARGET_DATE="${{ steps.target.outputs.target_date }}"
          CURRENT_TIME=$(TZ=Asia/Tokyo date '+%Yå¹´%mæœˆ%dæ—¥ %H:%M JST')
          TEST_MSG="${{ github.event.inputs.test_message }}"
          
          echo "ğŸ¤– Testing Bot Token notification with PDF upload..."
          echo "   Target date: $TARGET_DATE"
          echo "   Channel: $SLACK_CHANNEL"
          
          if [ ! -f "test-output/test-$TARGET_DATE.pdf" ]; then
            echo "âŒ PDF file not found: test-output/test-$TARGET_DATE.pdf"
            exit 1
          fi
          
          FILE_SIZE=$(stat -c%s "test-output/test-$TARGET_DATE.pdf")
          echo "ğŸ“Š File size: $FILE_SIZE bytes"
          
          # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ã‚­ã‚¹ãƒˆã‚’æº–å‚™
          MESSAGE_TEXT="$TEST_MSG - $CURRENT_TIME
          
          ğŸ“‹ ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚¤ãƒ³ãƒˆ:
          â€¢ å†…å®¹ã®æ­£ç¢ºæ€§
          â€¢ èª¬æ˜ã®åˆ†ã‹ã‚Šã‚„ã™ã•
          â€¢ æ™‚é–“é…åˆ†
          â€¢ ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³
          
          ğŸ’¬ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ–¹æ³•: ã“ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’ãŠé¡˜ã„ã—ã¾ã™
          
          âš ï¸ ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆé€šçŸ¥ã§ã™"
          
          # Method 1: æ¨å¥¨ã•ã‚Œã‚‹æ–¹æ³• - completeUploadExternalã§ãƒãƒ£ãƒ³ãƒãƒ«å…±æœ‰ã‚‚åŒæ™‚ã«è¡Œã†
          echo "ğŸ“¤ Attempting PDF file upload with direct channel sharing..."
          
          # Step 1: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰URLã‚’å–å¾—
          echo "Step 1: Getting upload URL..."
          UPLOAD_URL_RESPONSE=$(curl -s -X POST \
            -H "Authorization: Bearer $SLACK_BOT_TOKEN" \
            -H "Content-Type: application/json" \
            --data-raw "{\"filename\":\"test-slide-$TARGET_DATE.pdf\",\"length\":$FILE_SIZE,\"alt_txt\":\"$TARGET_DATE ã®ã‚¹ãƒ©ã‚¤ãƒ‰\"}" \
            https://slack.com/api/files.getUploadURLExternal)
          
          echo "Upload URL response: $UPLOAD_URL_RESPONSE"
          
          # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ç¢ºèª
          if echo "$UPLOAD_URL_RESPONSE" | grep -q '"ok":true'; then
            # JSONã‹ã‚‰å€¤ã‚’å®‰å…¨ã«æŠ½å‡º
            UPLOAD_URL=$(echo "$UPLOAD_URL_RESPONSE" | sed -n 's/.*"upload_url":"\([^"]*\)".*/\1/p')
            FILE_ID=$(echo "$UPLOAD_URL_RESPONSE" | sed -n 's/.*"file_id":"\([^"]*\)".*/\1/p')
            
            echo "âœ… Upload URL obtained"
            echo "   File ID: $FILE_ID"
            
            # Step 2: ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
            echo "Step 2: Uploading file..."
            UPLOAD_STATUS=$(curl -s -w "%{http_code}" -X POST \
              -F "file=@test-output/test-$TARGET_DATE.pdf" \
              "$UPLOAD_URL" \
              -o /dev/null)
            
            if [ "$UPLOAD_STATUS" = "200" ] || [ "$UPLOAD_STATUS" = "201" ] || [ "$UPLOAD_STATUS" = "204" ]; then
              echo "âœ… File uploaded successfully (HTTP $UPLOAD_STATUS)"
              
              # Step 3: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†ã¨ãƒãƒ£ãƒ³ãƒãƒ«å…±æœ‰ã‚’åŒæ™‚ã«å®Ÿè¡Œ
              echo "Step 3: Completing upload and sharing to channel..."
              
              # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
              ESCAPED_MESSAGE=$(echo "$MESSAGE_TEXT" | sed 's/"/\\"/g' | sed ':a;N;$!ba;s/\n/\\n/g')
              
              COMPLETE_RESPONSE=$(curl -s -X POST \
                -H "Authorization: Bearer $SLACK_BOT_TOKEN" \
                -H "Content-Type: application/json" \
                --data-raw "{\"files\":[{\"id\":\"$FILE_ID\",\"title\":\"ãƒ†ã‚¹ãƒˆç”¨ã‚¹ãƒ©ã‚¤ãƒ‰ ($TARGET_DATE)\"}],\"channel_id\":\"$SLACK_CHANNEL\",\"initial_comment\":\"$ESCAPED_MESSAGE\"}" \
                https://slack.com/api/files.completeUploadExternal)
              
              echo "Complete upload response: $COMPLETE_RESPONSE"
              
              if echo "$COMPLETE_RESPONSE" | grep -q '"ok":true'; then
                echo "ğŸ‰ PDF upload and sharing successful!"
                echo "âœ… File has been uploaded and shared to the channel"
              else
                ERROR_MSG=$(echo "$COMPLETE_RESPONSE" | sed -n 's/.*"error":"\([^"]*\)".*/\1/p')
                echo "âŒ Failed to complete upload: $ERROR_MSG"
                
                # Method 2: ä»£æ›¿æ–¹æ³• - ã¾ãšcompleteUploadExternalã—ã¦ã‹ã‚‰chat.postMessageã§å…±æœ‰
                echo "ğŸ”„ Trying alternative method..."
                
                # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã®ã¿å®Œäº†
                COMPLETE_ONLY_RESPONSE=$(curl -s -X POST \
                  -H "Authorization: Bearer $SLACK_BOT_TOKEN" \
                  -H "Content-Type: application/json" \
                  --data-raw "{\"files\":[{\"id\":\"$FILE_ID\",\"title\":\"ãƒ†ã‚¹ãƒˆç”¨ã‚¹ãƒ©ã‚¤ãƒ‰ ($TARGET_DATE)\"}]}" \
                  https://slack.com/api/files.completeUploadExternal)
                
                if echo "$COMPLETE_ONLY_RESPONSE" | grep -q '"ok":true'; then
                  echo "âœ… Upload completed, now sharing..."
                  
                  # chat.postMessageã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…±æœ‰
                  SHARE_RESPONSE=$(curl -s -X POST \
                    -H "Authorization: Bearer $SLACK_BOT_TOKEN" \
                    -H "Content-Type: application/json" \
                    --data-raw "{\"channel\":\"$SLACK_CHANNEL\",\"text\":\"$ESCAPED_MESSAGE\",\"files\":\"$FILE_ID\"}" \
                    https://slack.com/api/chat.postMessage)
                  
                  echo "Share response: $SHARE_RESPONSE"
                  
                  if echo "$SHARE_RESPONSE" | grep -q '"ok":true'; then
                    echo "ğŸ‰ Alternative method successful!"
                  else
                    echo "âŒ Alternative method also failed"
                    ERROR_MSG=$(echo "$SHARE_RESPONSE" | sed -n 's/.*"error":"\([^"]*\)".*/\1/p')
                    echo "   Error: $ERROR_MSG"
                  fi
                fi
              fi
            else
              echo "âŒ File upload failed (HTTP $UPLOAD_STATUS)"
            fi
          else
            ERROR_MSG=$(echo "$UPLOAD_URL_RESPONSE" | sed -n 's/.*"error":"\([^"]*\)".*/\1/p')
            echo "âŒ Failed to get upload URL: $ERROR_MSG"
          fi
          
          # Method 3: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ - ãƒªãƒ³ã‚¯é€ä¿¡
          echo ""
          echo "ğŸ”„ Fallback: Sending message with GitHub Pages link..."
          
          GITHUB_LINK="https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/slides/$TARGET_DATE.pdf"
          FALLBACK_MESSAGE=$(cat <<EOF
          $TEST_MSG - $CURRENT_TIME
          
          ğŸ“‹ ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚¤ãƒ³ãƒˆ:
          â€¢ å†…å®¹ã®æ­£ç¢ºæ€§
          â€¢ èª¬æ˜ã®åˆ†ã‹ã‚Šã‚„ã™ã•
          â€¢ æ™‚é–“é…åˆ†
          â€¢ ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³
          
          ğŸ’¬ ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯æ–¹æ³•: ã“ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚’ãŠé¡˜ã„ã—ã¾ã™
          
          ğŸ“ PDFãƒªãƒ³ã‚¯: $GITHUB_LINK
          
          âš ï¸ ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆé€šçŸ¥ã§ã™ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
          EOF
          )
          
          FALLBACK_JSON=$(jq -n \
            --arg channel "$SLACK_CHANNEL" \
            --arg text "$FALLBACK_MESSAGE" \
            '{channel: $channel, text: $text}')
          
          FALLBACK_RESPONSE=$(curl -s -X POST \
            -H "Authorization: Bearer $SLACK_BOT_TOKEN" \
            -H "Content-Type: application/json" \
            -d "$FALLBACK_JSON" \
            https://slack.com/api/chat.postMessage)
          
          echo "Fallback response: $FALLBACK_RESPONSE"
          
          if echo "$FALLBACK_RESPONSE" | grep -q '"ok":true'; then
            echo "âœ… Fallback message sent successfully"
          else
            echo "âŒ Fallback also failed"
          fi

      - name: Test Webhook notification
        if: (github.event.inputs.notification_type == 'webhook_with_links' || github.event.inputs.notification_type == 'test_all_methods') && steps.config.outputs.webhook_available == 'true'
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          TARGET_DATE="${{ steps.target.outputs.target_date }}"
          PAGES_URL="https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}"
          CURRENT_TIME=$(TZ=Asia/Tokyo date '+%Yå¹´%mæœˆ%dæ—¥ %H:%M JST')
          TEST_MSG="${{ github.event.inputs.test_message }}"
          
          echo "ğŸª Testing Webhook notification..."
          
          curl -X POST -H 'Content-type: application/json' \
            --data "{
              \"blocks\": [
                {
                  \"type\": \"section\",
                  \"text\": {
                    \"type\": \"mrkdwn\",
                    \"text\": \"$TEST_MSG - Webhook ãƒ†ã‚¹ãƒˆ\\n\\n${CURRENT_TIME} æ™‚ç‚¹ã§ã®è³‡æ–™ã¯ã“ã¡ã‚‰ã§ã™ã€‚ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚\"
                  }
                },
                {
                  \"type\": \"section\",
                  \"text\": {
                    \"type\": \"mrkdwn\",
                    \"text\": \"ğŸ“‹ ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒã‚¤ãƒ³ãƒˆ:\\nâ€¢ å†…å®¹ã®æ­£ç¢ºæ€§\\nâ€¢ èª¬æ˜ã®åˆ†ã‹ã‚Šã‚„ã™ã•\\nâ€¢ æ™‚é–“é…åˆ†\\nâ€¢ ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ‡ã‚¶ã‚¤ãƒ³\"
                  }
                },
                {
                  \"type\": \"actions\",
                  \"elements\": [
                    {
                      \"type\": \"button\",
                      \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ“„ PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\" },
                      \"url\": \"${PAGES_URL}/slides/${TARGET_DATE}.pdf\",
                      \"style\": \"primary\"
                    },
                    {
                      \"type\": \"button\",
                      \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ“Š HTMLãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼\" },
                      \"url\": \"${PAGES_URL}/slides/${TARGET_DATE}.html\"
                    }
                  ]
                },
                {
                  \"type\": \"context\",
                  \"elements\": [
                    {
                      \"type\": \"mrkdwn\",
                      \"text\": \"âš ï¸ ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆé€šçŸ¥ã§ã™ | ğŸ’¬ ã“ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã«ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚’ãŠé¡˜ã„ã—ã¾ã™\"
                    }
                  ]
                }
              ]
            }" \
            $SLACK_WEBHOOK_URL
          
          if [ $? -eq 0 ]; then
            echo "âœ… Webhook test successful!"
          else
            echo "âŒ Webhook test failed"
          fi

      - name: Test no-slide notification
        if: github.event.inputs.notification_type == 'no_slide_notification' || github.event.inputs.notification_type == 'test_all_methods'
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          TARGET_DATE="${{ steps.target.outputs.target_date }}"
          PAGES_URL="https://alt9800.github.io/2025-RemoteSensingSeminar"
          TEST_MSG="${{ github.event.inputs.test_message }}"
          
          echo "ğŸ“­ Testing no-slide notification..."
          
          if [ -n "$SLACK_WEBHOOK_URL" ]; then
            curl -X POST -H 'Content-type: application/json' \
              --data "{
                \"blocks\": [
                  {
                    \"type\": \"section\",
                    \"text\": {
                      \"type\": \"mrkdwn\",
                      \"text\": \"$TEST_MSG - ã‚¹ãƒ©ã‚¤ãƒ‰ãªã—é€šçŸ¥ãƒ†ã‚¹ãƒˆ\\n\\nâš ï¸ **ãƒ¬ãƒ“ãƒ¥ãƒ¼é€šçŸ¥**\\n\\nã¾ã å‡ºæ¥ä¸ŠãŒã£ã¦ãªã„ã¿ãŸã„ã§ã™ã€å°‘ã€…ãŠå¾…ã¡ãã ã•ã„...\"
                    }
                  },
                  {
                    \"type\": \"actions\",
                    \"elements\": [
                      {
                        \"type\": \"button\",
                        \"text\": { \"type\": \"plain_text\", \"text\": \"ğŸ“‹ è³‡æ–™ã‚µã‚¤ãƒˆã§ç¢ºèª\" },
                        \"url\": \"${PAGES_URL}\",
                        \"style\": \"primary\"
                      }
                    ]
                  },
                  {
                    \"type\": \"context\",
                    \"elements\": [
                      {
                        \"type\": \"mrkdwn\",
                        \"text\": \"âš ï¸ ã“ã‚Œã¯ãƒ†ã‚¹ãƒˆé€šçŸ¥ã§ã™ | ğŸ“ è³‡æ–™ã®æº–å‚™ãŒã§ãæ¬¡ç¬¬ã€æ”¹ã‚ã¦ãƒ¬ãƒ“ãƒ¥ãƒ¼ä¾é ¼ã‚’ãŠé€ã‚Šã—ã¾ã™\"
                      }
                    ]
                  }
                ]
              }" \
              $SLACK_WEBHOOK_URL
            
            if [ $? -eq 0 ]; then
              echo "âœ… No-slide notification test successful!"
            else
              echo "âŒ No-slide notification test failed"
            fi
          else
            echo "âš ï¸ Webhook URL not configured, skipping no-slide test"
          fi

      - name: Test summary
        if: always()
        run: |
          echo "## ğŸ§ª Slacké€šçŸ¥ãƒ†ã‚¹ãƒˆçµæœ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ—¥æ™‚:** $(TZ=Asia/Tokyo date '+%Yå¹´%mæœˆ%dæ—¥ %H:%M JST')" >> $GITHUB_STEP_SUMMARY
          echo "**å¯¾è±¡æ—¥ä»˜:** ${{ steps.target.outputs.target_date }}" >> $GITHUB_STEP_SUMMARY
          echo "**ãƒ†ã‚¹ãƒˆã‚¿ã‚¤ãƒ—:** ${{ github.event.inputs.notification_type }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          
          echo "### ğŸ“Š è¨­å®šçŠ¶æ³" >> $GITHUB_STEP_SUMMARY
          if [ "${{ steps.config.outputs.bot_available }}" = "true" ]; then
            echo "- âœ… Bot Tokenè¨­å®šæ¸ˆã¿" >> $GITHUB_STEP_SUMMARY
          else
            echo "- âŒ Bot Tokenæœªè¨­å®š" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ "${{ steps.config.outputs.webhook_available }}" = "true" ]; then
            echo "- âœ… Webhookè¨­å®šæ¸ˆã¿" >> $GITHUB_STEP_SUMMARY
          else
            echo "- âŒ Webhookæœªè¨­å®š" >> $GITHUB_STEP_SUMMARY
          fi
          
          if [ "${{ steps.target.outputs.slide_exists }}" = "true" ]; then
            echo "- âœ… ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨" >> $GITHUB_STEP_SUMMARY
          else
            echo "- âŒ ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ãªã—" >> $GITHUB_STEP_SUMMARY
          fi
          
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ’¡ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—" >> $GITHUB_STEP_SUMMARY
          echo "1. Slackã§ãƒ†ã‚¹ãƒˆé€šçŸ¥ã‚’ç¢ºèªã—ã¦ãã ã•ã„" >> $GITHUB_STEP_SUMMARY
          echo "2. å•é¡ŒãŒã‚ã‚Œã°è¨­å®šã‚’è¦‹ç›´ã—ã¦ãã ã•ã„" >> $GITHUB_STEP_SUMMARY
          echo "3. æ­£å¸¸ã§ã‚ã‚Œã°æœ¬ç•ªç”¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„" >> $GITHUB_STEP_SUMMARY

      - name: Cleanup
        if: always()
        run: |
          rm -rf test-output