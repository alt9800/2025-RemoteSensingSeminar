---
marp: true
theme: default
header: "è¡›æ˜Ÿãƒ‡ãƒ¼ã‚¿è§£ææŠ€è¡“ç ”ç©¶ä¼š<br>æŠ€è¡“ã‚»ãƒŸãƒŠãƒ¼ï¼ˆå¿œç”¨ç·¨ï¼‰"
footer: "ç¬¬äº”å› 2025/07/25"

paginate: true

style: |
    section.title {
        justify-content: center;
        text-align: left;
    }
    .round-icon {
      position: absolute;
      top: 50px;
      right: 50px;
      width: 400px;
      height: 400px;
      border-radius: 20%;
      object-fit: cover;
      z-index: 10;
    }
    .tiny-text {
    font-size: 0.6em;  /* é€šå¸¸ã®60%ã‚µã‚¤ã‚º */
    }
    img {
      max-width: 100%;
      height: auto;
      image-rendering: -webkit-optimize-contrast;
    }



---
# è¡›æ˜Ÿãƒ‡ãƒ¼ã‚¿è§£ææŠ€è¡“ç ”ç©¶ä¼š<br>æŠ€è¡“ã‚»ãƒŸãƒŠãƒ¼ï¼ˆå¿œç”¨ç·¨ï¼‰
## Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹ç™ºæŠ€è¡“ã®ç¿’å¾—

ç¬¬äº”å› 2025/07/25

æ‹…å½“è¬›å¸« : ç”°ä¸­è¡è‡³

---

ãŠçŸ¥ã‚‰ã› 1
Slackã®ãƒªãƒ³ã‚¯
https://join.slack.com/t/2025-qzu7873/shared_invite/zt-39hkj0z6q-8vt0qOy7h1zJ7Ug9mwM~7A

ãªã‚“ã‚‰ã‹ã®åŸå› ã§ã€Slackã«å…¥ã‚Œãªããªã£ãŸæ–¹ã¯ã“ã¡ã‚‰ã‹ã‚‰
8/15ã«ãƒªãƒ³ã‚¯ãŒæ¶ˆå¤±ã—ã¾ã™ã€‚
(è¬›ç¾©å¾Œã¯Slackã®ãŠéƒ¨å±‹ã¯ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ã›ãšã«æ¶ˆãˆã‚‹ã¾ã§æ®‹ã™äºˆå®šã§ã™ã€‚ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¯ã¨ã‚Šã¾ã™ã€‚)


---

ãŠçŸ¥ã‚‰ã› 2
https://alt9800.github.io/2025-RemoteSensingSeminar/
è¬›ç¾©è³‡æ–™ã¯ã‚¹ãƒ©ã‚¤ãƒ‰ (pdf)ã ã¨ã€ã‚³ãƒ¼ãƒ‰ã®ã‚³ãƒ”ãƒšãŒã—ã«ãã‹ã£ãŸã®ã§ã€
è¬›ç¾©è³‡æ–™ã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ãŒåˆ©ç”¨ã—ã‚„ã™ã„ã‚ˆã†ã«htmlã§ã‚‚æä¾›ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚



---

![w:1100](2025-07-25/assets/image1.png)

---



![w:900](2025-07-25/assets/image2.png)

---

å‰å›ã®ã‚ã‚‰ã™ã˜

### ã‚†ã‚‹ã„MVC
Model: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å‡¦ç†ï¼ˆãŸã ã—routeså†…ã«æ··åœ¨ã—ã¦ãŠã‚Šã€å˜ä¸€è²¬ä»»åŸå‰‡ã¯æº€ãŸã•ãªã„ï¼‰
View: é™çš„HTML + JSON API
Controller: routesä»¥ä¸‹

(ãã‚‚ãã‚‚Express.jsè‡ªä½“ãŒroutesä»¥ä¸‹ã«Controllerã¨Modelä¸¡æ–¹ã®å½¹å‰²ã‚’æŒã¤æ§‹æˆã«ãªã‚‹)

---

ğŸ¤å‰å›ã¯ã‚ã¾ã‚Šè§¦ã‚Œã¾ã›ã‚“ã§ã—ãŸãŒã€ã‚„ã£ãŸã“ã¨å˜ä½ã§gitã«ã‚»ãƒ¼ãƒ–ãƒã‚¤ãƒ³ãƒˆ(commit)ã‚’è¿½åŠ ã—ã¦ã„ãã¨ã‚ˆã„ã‹ã‚‚

---


```
src/
â””â”€â”€ routes/
    â”œâ”€â”€ auth.js       # èªè¨¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
    â”œâ”€â”€ users.js      # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
    â””â”€â”€ posts.js      # æŠ•ç¨¿ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
```


---

å„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å½¹å‰²(ç¬¬5å›ç›®ã¾ã§ã®å†…å®¹ã‚’è£œè¶³)
```
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”œâ”€â”€ express (Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯)
â”‚   â”œâ”€â”€ cors (CORSè¨­å®š)
â”‚   â”œâ”€â”€ helmet (ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼)
â”‚   â””â”€â”€ express-validator (å…¥åŠ›æ¤œè¨¼)
â”œâ”€â”€ èªè¨¼æ©Ÿèƒ½
â”‚   â”œâ”€â”€ jsonwebtoken (ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†)
â”‚   â””â”€â”€ bcrypt (ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æš—å·åŒ–)
â”œâ”€â”€ ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–
â”‚   â””â”€â”€ sqlite3 (ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹)
â”œâ”€â”€ ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†
â”‚   â””â”€â”€ multer (ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰)
â””â”€â”€ è¨­å®šãƒ»é–‹ç™º
    â”œâ”€â”€ dotenv (ç’°å¢ƒå¤‰æ•°)
    â””â”€â”€ nodemon (é–‹ç™ºç”¨)
```

---

# æŠ•ç¨¿æ©Ÿèƒ½ã‚’ä½œã‚ã†ï¼

---

scripts/init-db.js

```js
const sqlite3 = require('sqlite3').verbose();
const path = require('path');
const fs = require('fs');
const dotenv = require('dotenv');

// ç’°å¢ƒå¤‰æ•°ã®èª­ã¿è¾¼ã¿
dotenv.config();

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
const dbDir = path.join(__dirname, '../db');
if (!fs.existsSync(dbDir)) {
  fs.mkdirSync(dbDir, { recursive: true });
}

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹
const dbPath = process.env.DB_PATH || path.join(dbDir, 'database.db');

// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åˆæœŸåŒ–
const db = new sqlite3.Database(dbPath);

console.log('Initializing database...');

db.serialize(() => {
  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ—¢å­˜ï¼‰
  db.run(`
    CREATE TABLE IF NOT EXISTS users (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      user_id VARCHAR(50) UNIQUE NOT NULL,
      email VARCHAR(255) UNIQUE NOT NULL,
      password_hash VARCHAR(255) NOT NULL,
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
    )
  `);

  // æŠ•ç¨¿ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆæ–°è¦è¿½åŠ ï¼‰
  db.run(`
    CREATE TABLE IF NOT EXISTS posts (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      user_id INTEGER NOT NULL,
      latitude REAL NOT NULL,
      longitude REAL NOT NULL,
      comment TEXT,
      image_path VARCHAR(500),
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
      updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
    )
  `);

  // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ä½œæˆ
  db.run('CREATE INDEX IF NOT EXISTS idx_posts_user_id ON posts(user_id)');
  db.run('CREATE INDEX IF NOT EXISTS idx_posts_location ON posts(latitude, longitude)');
  db.run('CREATE INDEX IF NOT EXISTS idx_posts_created_at ON posts(created_at DESC)');

  console.log('Database initialization completed!');
});

db.close((err) => {
  if (err) {
    console.error('Error closing database:', err);
  } else {
    console.log('Database connection closed.');
  }
});
```

---

```js
node scripts/init-db.js
```


---

â˜ï¸æ–°è¦è¿½åŠ åˆ†ã®æŠ•ç¨¿ãƒ†ãƒ¼ãƒ–ãƒ«ã«æ³¨ç›®
```js
  db.run(`
    CREATE TABLE IF NOT EXISTS posts (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      user_id INTEGER NOT NULL,
      latitude REAL NOT NULL,
      longitude REAL NOT NULL,
      comment TEXT,
      image_path VARCHAR(500),
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
      updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
      FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
    )
  `);
```

---




## æŠ•ç¨¿é–¢é€£APIã®å®Ÿè£…

### æŠ•ç¨¿ãƒ«ãƒ¼ãƒˆã®ä½œæˆ

`src/routes/posts.js`ã‚’æ–°ãŸã«ä½œã‚‹

---

`src/routes/posts.js`

```js

const express = require('express');
const multer = require('multer');
const path = require('path');
const fs = require('fs').promises;
const { body, validationResult } = require('express-validator');
const db = require('../config/db');
const { authenticateToken, optionalAuth } = require('../middleware/auth');

const router = express.Router();

// ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä½œæˆ
const uploadDir = path.join(__dirname, '../../uploads');
fs.mkdir(uploadDir, { recursive: true }).catch(console.error);

// Multerã®è¨­å®šï¼ˆ1.3ã§è©³ç´°è¨­å®šï¼‰
const storage = multer.diskStorage({
  destination: async (req, file, cb) => {
    cb(null, uploadDir);
  },
  filename: (req, file, cb) => {
    const uniqueSuffix = Date.now() + '-' + Math.round(Math.random() * 1E9);
    cb(null, uniqueSuffix + path.extname(file.originalname));
  }
});

const upload = multer({
  storage: storage,
  limits: {
    fileSize: parseInt(process.env.UPLOAD_MAX_SIZE) || 10 * 1024 * 1024 // 10MB
  },
  fileFilter: (req, file, cb) => {
    const allowedExtensions = (process.env.ALLOWED_EXTENSIONS || 'jpg,jpeg,png,gif').split(',');
    const ext = path.extname(file.originalname).toLowerCase().substring(1);
    
    if (allowedExtensions.includes(ext)) {
      cb(null, true);
    } else {
      cb(new Error('è¨±å¯ã•ã‚Œã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã§ã™'));
    }
  }
});

// æŠ•ç¨¿ä¸€è¦§ã®å–å¾—ï¼ˆèªè¨¼ä¸è¦ï¼‰
router.get('/', optionalAuth, async (req, res) => {
  try {
    const { limit = 50, offset = 0 } = req.query;
    
    const query = `
      SELECT 
        p.id,
        p.latitude,
        p.longitude,
        p.comment,
        p.image_path,
        p.created_at,
        p.user_id,
        u.user_id as username
      FROM posts p
      JOIN users u ON p.user_id = u.id
      ORDER BY p.created_at DESC
      LIMIT ? OFFSET ?
    `;
    
    const result = await db.query(query, [parseInt(limit), parseInt(offset)]);
    
    // ç”»åƒãƒ‘ã‚¹ã‚’å®Œå…¨ãªURLã«å¤‰æ›
    const posts = result.rows.map(post => ({
      ...post,
      image_url: post.image_path ? `/uploads/${path.basename(post.image_path)}` : null,
      is_owner: req.user ? post.user_id === req.user.id : false
    }));
    
    res.json({
      posts,
      total: posts.length
    });
    
  } catch (error) {
    console.error('Get posts error:', error);
    res.status(500).json({ message: 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' });
  }
});

// ç‰¹å®šã®æŠ•ç¨¿ã®å–å¾—
router.get('/:id', optionalAuth, async (req, res) => {
  try {
    const { id } = req.params;
    
    const query = `
      SELECT 
        p.id,
        p.latitude,
        p.longitude,
        p.comment,
        p.image_path,
        p.created_at,
        p.user_id,
        u.user_id as username
      FROM posts p
      JOIN users u ON p.user_id = u.id
      WHERE p.id = ?
    `;
    
    const result = await db.query(query, [id]);
    
    if (result.rows.length === 0) {
      return res.status(404).json({ message: 'æŠ•ç¨¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' });
    }
    
    const post = result.rows[0];
    res.json({
      ...post,
      image_url: post.image_path ? `/uploads/${path.basename(post.image_path)}` : null,
      is_owner: req.user ? post.user_id === req.user.id : false
    });
    
  } catch (error) {
    console.error('Get post error:', error);
    res.status(500).json({ message: 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' });
  }
});

// æ–°è¦æŠ•ç¨¿ã®ä½œæˆï¼ˆèªè¨¼å¿…è¦ï¼‰
router.post('/', authenticateToken, upload.single('image'), [
  body('latitude').isFloat({ min: -90, max: 90 }),
  body('longitude').isFloat({ min: -180, max: 180 }),
  body('comment').optional().isLength({ max: 1000 })
], async (req, res) => {
  try {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
      if (req.file) {
        await fs.unlink(req.file.path).catch(console.error);
      }
      return res.status(400).json({ errors: errors.array() });
    }
    
    const { latitude, longitude, comment } = req.body;
    const imagePath = req.file ? req.file.filename : null;
    
    const query = `
      INSERT INTO posts (user_id, latitude, longitude, comment, image_path)
      VALUES (?, ?, ?, ?, ?)
    `;
    
    const result = await db.query(query, [
      req.user.id,
      parseFloat(latitude),
      parseFloat(longitude),
      comment || '',
      imagePath
    ]);
    
    const postId = result.rows[0].id;
    
    // ä½œæˆã—ãŸæŠ•ç¨¿ã‚’å–å¾—
    const getPostQuery = `
      SELECT 
        p.*,
        u.user_id as username
      FROM posts p
      JOIN users u ON p.user_id = u.id
      WHERE p.id = ?
    `;
    
    const newPost = await db.query(getPostQuery, [postId]);
    const post = newPost.rows[0];
    
    res.status(201).json({
      message: 'æŠ•ç¨¿ãŒä½œæˆã•ã‚Œã¾ã—ãŸ',
      post: {
        ...post,
        image_url: imagePath ? `/uploads/${imagePath}` : null,
        is_owner: true
      }
    });
    
  } catch (error) {
    console.error('Create post error:', error);
    // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
    if (req.file) {
      await fs.unlink(req.file.path).catch(console.error);
    }
    res.status(500).json({ message: 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' });
  }
});

// æŠ•ç¨¿ã®æ›´æ–°ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã®ã¿ï¼‰
router.put('/:id', authenticateToken, [
  body('comment').optional().isLength({ max: 1000 })
], async (req, res) => {
  try {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      return res.status(400).json({ errors: errors.array() });
    }
    
    const { id } = req.params;
    const { comment } = req.body;
    
    // æ‰€æœ‰è€…ç¢ºèª
    const checkQuery = 'SELECT user_id FROM posts WHERE id = ?';
    const checkResult = await db.query(checkQuery, [id]);
    
    if (checkResult.rows.length === 0) {
      return res.status(404).json({ message: 'æŠ•ç¨¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' });
    }
    
    if (checkResult.rows[0].user_id !== req.user.id) {
      return res.status(403).json({ message: 'ã“ã®æŠ•ç¨¿ã‚’ç·¨é›†ã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“' });
    }
    
    // æ›´æ–°å®Ÿè¡Œ
    const updateQuery = `
      UPDATE posts 
      SET comment = ?, updated_at = CURRENT_TIMESTAMP
      WHERE id = ?
    `;
    
    await db.query(updateQuery, [comment, id]);
    
    // æ›´æ–°å¾Œã®æŠ•ç¨¿ã‚’å–å¾—
    const getPostQuery = `
      SELECT 
        p.*,
        u.user_id as username
      FROM posts p
      JOIN users u ON p.user_id = u.id
      WHERE p.id = ?
    `;
    
    const result = await db.query(getPostQuery, [id]);
    const post = result.rows[0];
    
    res.json({
      message: 'æŠ•ç¨¿ãŒæ›´æ–°ã•ã‚Œã¾ã—ãŸ',
      post: {
        ...post,
        image_url: post.image_path ? `/uploads/${post.image_path}` : null,
        is_owner: true
      }
    });
    
  } catch (error) {
    console.error('Update post error:', error);
    res.status(500).json({ message: 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' });
  }
});

// æŠ•ç¨¿ã®å‰Šé™¤
router.delete('/:id', authenticateToken, async (req, res) => {
  try {
    const { id } = req.params;
    
    // æ‰€æœ‰è€…ç¢ºèªã¨ç”»åƒãƒ‘ã‚¹ã®å–å¾—
    const checkQuery = 'SELECT user_id, image_path FROM posts WHERE id = ?';
    const checkResult = await db.query(checkQuery, [id]);
    
    if (checkResult.rows.length === 0) {
      return res.status(404).json({ message: 'æŠ•ç¨¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“' });
    }
    
    if (checkResult.rows[0].user_id !== req.user.id) {
      return res.status(403).json({ message: 'ã“ã®æŠ•ç¨¿ã‚’å‰Šé™¤ã™ã‚‹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“' });
    }
    
    const imagePath = checkResult.rows[0].image_path;
    
    // å‰Šé™¤å®Ÿè¡Œ
    await db.query('DELETE FROM posts WHERE id = ?', [id]);
    
    // ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤
    if (imagePath) {
      const fullPath = path.join(uploadDir, imagePath);
      await fs.unlink(fullPath).catch(console.error);
    }
    
    res.json({ message: 'æŠ•ç¨¿ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸ' });
    
  } catch (error) {
    console.error('Delete post error:', error);
    res.status(500).json({ message: 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' });
  }
});

// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æŠ•ç¨¿ä¸€è¦§
router.get('/user/:userId', optionalAuth, async (req, res) => {
  try {
    const { userId } = req.params;
    const { limit = 50, offset = 0 } = req.query;
    
    const query = `
      SELECT 
        p.id,
        p.latitude,
        p.longitude,
        p.comment,
        p.image_path,
        p.created_at,
        p.user_id,
        u.user_id as username
      FROM posts p
      JOIN users u ON p.user_id = u.id
      WHERE u.user_id = ?
      ORDER BY p.created_at DESC
      LIMIT ? OFFSET ?
    `;
    
    const result = await db.query(query, [userId, parseInt(limit), parseInt(offset)]);
    
    const posts = result.rows.map(post => ({
      ...post,
      image_url: post.image_path ? `/uploads/${path.basename(post.image_path)}` : null,
      is_owner: req.user ? post.user_id === req.user.id : false
    }));
    
    res.json({
      posts,
      total: posts.length
    });
    
  } catch (error) {
    console.error('Get user posts error:', error);
    res.status(500).json({ message: 'ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' });
  }
});

module.exports = router;
```

---

èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®æ›´æ–°

src/middleware/auth.jsã«optionalAuthã‚’è¿½åŠ ï¼š


---

```js
const jwt = require('jsonwebtoken');

const JWT_SECRET = process.env.JWT_SECRET || 'your-jwt-secret-key-change-in-production';

// JWTãƒˆãƒ¼ã‚¯ãƒ³ã®ç”Ÿæˆ
const generateToken = (user) => {
  return jwt.sign(
    { 
      id: user.id, 
      user_id: user.user_id,
      email: user.email 
    },
    JWT_SECRET,
    { expiresIn: '7d' }
  );
};

// èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
const authenticateToken = (req, res, next) => {
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1];

  if (!token) {
    return res.status(401).json({ message: 'èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦ã§ã™' });
  }

  jwt.verify(token, JWT_SECRET, (err, user) => {
    if (err) {
      return res.status(403).json({ message: 'ãƒˆãƒ¼ã‚¯ãƒ³ãŒç„¡åŠ¹ã§ã™' });
    }
    req.user = user;
    next();
  });
};

// ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«èªè¨¼ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªãã¦ã‚‚OKï¼‰
const optionalAuth = (req, res, next) => {
  const authHeader = req.headers['authorization'];
  const token = authHeader && authHeader.split(' ')[1];

  if (!token) {
    return next();
  }

  jwt.verify(token, JWT_SECRET, (err, user) => {
    if (!err) {
      req.user = user;
    }
    next();
  });
};

module.exports = {
  generateToken,
  authenticateToken,
  optionalAuth
};
```



---

`src/server.js`ã‚’æ›´æ–°ã—ã¦æŠ•ç¨¿ãƒ«ãƒ¼ãƒˆã‚’è¿½åŠ ï¼š
```js

const express = require('express');
const path = require('path');
const helmet = require('helmet');
const cors = require('cors');
const dotenv = require('dotenv');

// ç’°å¢ƒå¤‰æ•°ã®èª­ã¿è¾¼ã¿
dotenv.config();

const app = express();
const PORT = process.env.PORT || 3000;

// ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®è¨­å®š
app.use(helmet({
  contentSecurityPolicy: false,
  crossOriginEmbedderPolicy: false,
}));

app.use(cors());
app.use(express.json());
app.use(express.urlencoded({ extended: true }));

// é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã®é…ä¿¡
app.use(express.static(path.join(__dirname, '../public')));
app.use('/uploads', express.static(path.join(__dirname, '../uploads')));

// ãƒ«ãƒ¼ã‚¿ãƒ¼ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
const authRoutes = require('./routes/auth');
const usersRoutes = require('./routes/users');
const postsRoutes = require('./routes/posts');  // è¿½åŠ 

// APIãƒ«ãƒ¼ãƒˆã®è¨­å®š
app.use('/api/auth', authRoutes);
app.use('/api/users', usersRoutes);
app.use('/api/posts', postsRoutes);  // è¿½åŠ 

// ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
app.use((err, req, res, next) => {
  console.error('Error:', err.stack);
  res.status(err.status || 500).json({
    message: err.message || 'Internal Server Error',
    ...(process.env.NODE_ENV === 'development' && { stack: err.stack })
  });
});

// 404ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
app.use((req, res) => {
  res.status(404).json({ message: 'Not Found' });
});

// ã‚µãƒ¼ãƒãƒ¼èµ·å‹•
app.listen(PORT, () => {
  console.log(`Server is running on port ${PORT}`);
  console.log(`Environment: ${process.env.NODE_ENV}`);
});
```

---

.envãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ã‚’è¿½åŠ ï¼š

```sh
# ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰è¨­å®š
UPLOAD_MAX_SIZE=10485760  # 10MB
ALLOWED_EXTENSIONS=jpg,jpeg,png,gif
```

æ¦‚ã­ã‚ˆãã‚„ã‚‹è¨­å®šã§ã™ã€‚

---

```sh
mkdir -p uploads
#gitã‚’ä½¿ã†äººã¯ä¸‹ã‚‚
touch uploads/.gitkeep
```

---

## ã“ã“ã§ä¸€æ—¦ãƒ†ã‚¹ãƒˆ

1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®å†åˆæœŸåŒ–
```sh
node scripts/init-db.js
```
2. ã‚µãƒ¼ãƒãƒ¼ã®èµ·å‹•
```sh
npm run dev
```
3. APIãƒ†ã‚¹ãƒˆï¼ˆcurlï¼‰

æŠ•ç¨¿ä¸€è¦§ã®å–å¾—ï¼ˆèªè¨¼ä¸è¦ï¼‰: GETãªã®ã§ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚‚...
```sh
curl http://localhost:3000/api/posts
#> {"posts":[],"total":0}
```

---
ãƒ†ã‚¹ãƒˆæŠ•ç¨¿

```sh
# ã¾ãšãƒ­ã‚°ã‚¤ãƒ³
TOKEN=$(curl -s -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"user_id": "testuser", "password": "password123"}' \
  | grep -o '"token":"[^"]*' | grep -o '[^"]*$')
```

(Q.JWTã¯ãƒ–ãƒ©ã‚¦ã‚¶ã ã¨ã©ã“ã«æŒãŸã‚Œã‚‹ã‹ï¼Ÿ A. localstorage)

```sh
# æŠ•ç¨¿ä½œæˆï¼ˆç”»åƒãªã—ï¼‰
curl -X POST http://localhost:3000/api/posts \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "latitude": 33.9980,
    "longitude": 131.2463,
    "comment": "ãƒ†ã‚¹ãƒˆæŠ•ç¨¿ã§ã™"
  }'
```

---

```sh
# æŠ•ç¨¿ä½œæˆï¼ˆç”»åƒä»˜ãï¼‰
curl -X POST http://localhost:3000/api/posts \
  -H "Authorization: Bearer $TOKEN" \
  -F "latitude=33.9980" \
  -F "longitude=131.2463" \
  -F "comment=ç”»åƒä»˜ãæŠ•ç¨¿" \
  -F "image=@/path/to/test.jpg"
```


---
GETãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¯”è¼ƒ

### æ–¹æ³•1: URLã«ç›´æ¥ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿
```sh
curl -X GET "https://example.com/api/users?name=John&age=30&city=Tokyo"
```

### æ–¹æ³•2: -Gã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¨--data-urlencode
```sh
curl -G https://example.com/api/users \
     -d "name=John" \
     -d "age=30" \
     -d "city=Tokyo"
(ã‚¹ãƒãƒ›ã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ã‚‚ã„ã„ã‹ã‚‚)
```

---

# CRUD

â˜ï¸ä½œæˆã—ãŸã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å‹•ä½œã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†

---

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   users                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK â”‚ id              â”‚ INTEGER    â”‚ AI      â”‚
â”‚    â”‚ user_id         â”‚ VARCHAR(50)â”‚ UNIQUE  â”‚
â”‚    â”‚ email           â”‚ VARCHAR(255)â”‚ UNIQUE â”‚
â”‚    â”‚ password_hash   â”‚ VARCHAR(255)â”‚        â”‚
â”‚    â”‚ created_at      â”‚ TIMESTAMP  â”‚ DEFAULT â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ 1
                          â”‚
                          â”‚
                          â”‚ *
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   posts                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PK â”‚ id              â”‚ INTEGER    â”‚ AI      â”‚
â”‚ FK â”‚ user_id         â”‚ INTEGER    â”‚ NOT NULLâ”‚
â”‚    â”‚ latitude        â”‚ REAL       â”‚ NOT NULLâ”‚
â”‚    â”‚ longitude       â”‚ REAL       â”‚ NOT NULLâ”‚
â”‚    â”‚ comment         â”‚ TEXT       â”‚         â”‚
â”‚    â”‚ image_path      â”‚ VARCHAR(500)â”‚        â”‚
â”‚    â”‚ created_at      â”‚ TIMESTAMP  â”‚ DEFAULT â”‚
â”‚    â”‚ updated_at      â”‚ TIMESTAMP  â”‚ DEFAULT â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```



---

### ç‰¹å®šã®æŠ•ç¨¿ã‚’å–å¾—
```sh
curl http://localhost:3000/api/posts/1
```
### æŠ•ç¨¿ã®æ›´æ–°
```sh
curl -X PUT http://localhost:3000/api/posts/1 \
  -H "Authorization: Bearer $TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"comment": "æ›´æ–°ã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆ"}
```
### æŠ•ç¨¿ã®å‰Šé™¤
```sh
curl -X DELETE http://localhost:3000/api/posts/1 \
  -H "Authorization: Bearer $TOKEN"
```
### ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥æŠ•ç¨¿ä¸€è¦§
```sh
curl http://localhost:3000/api/posts/user/testuser
```

---

ã“ã“ã¾ã§ã‚„ã£ãŸã“ã¨

1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒã®æ‹¡å¼µ

postsãƒ†ãƒ¼ãƒ–ãƒ«ã®è¿½åŠ 
å¿…è¦ãªã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®è¨­å®š
å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„ã®è¨­å®š

2. æŠ•ç¨¿é–¢é€£APIï¼ˆ6ã¤ï¼‰

GET /api/posts - æŠ•ç¨¿ä¸€è¦§ï¼ˆèªè¨¼ä¸è¦ï¼‰
GET /api/posts/:id - ç‰¹å®šæŠ•ç¨¿ã®å–å¾—
POST /api/posts - æ–°è¦æŠ•ç¨¿ï¼ˆèªè¨¼å¿…è¦ï¼‰
PUT /api/posts/:id - æŠ•ç¨¿æ›´æ–°ï¼ˆèªè¨¼å¿…è¦ï¼‰
DELETE /api/posts/:id - æŠ•ç¨¿å‰Šé™¤ï¼ˆèªè¨¼å¿…è¦ï¼‰
GET /api/posts/user/:userId - ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ¥ä¸€è¦§

3. ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½

multerã«ã‚ˆã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
10MBã®ã‚µã‚¤ã‚ºåˆ¶é™
jpg, jpeg, png, gifå½¢å¼ã®ã¿è¨±å¯
ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ•ã‚¡ã‚¤ãƒ«åç”Ÿæˆ

---

# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰(View)ã®ä½œæˆ

---

## ã¾ãšã¯åœ°å›³æ©Ÿèƒ½ä»¥å¤–ã®éƒ¨åˆ†ã®Viewã‚’ã€‚


### 1. HTMLãƒšãƒ¼ã‚¸ï¼ˆ4ã¤ï¼‰

index.html - ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ï¼ˆåœ°å›³ã¨æŠ•ç¨¿ä¸€è¦§ï¼‰
login/index.html - ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
signup/index.html - ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒšãƒ¼ã‚¸
mypage/index.html - ãƒã‚¤ãƒšãƒ¼ã‚¸

### 2. JavaScriptæ©Ÿèƒ½

common.js - å…±é€šé–¢æ•°ï¼ˆèªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†ã€æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆç­‰ï¼‰
auth.js - èªè¨¼é–¢é€£ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ã€ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ã€ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ï¼‰
map.js - åœ°å›³æ©Ÿèƒ½ã®æš«å®šç‰ˆï¼ˆæŠ•ç¨¿ä¸€è¦§ã®è¡¨ç¤ºã®ã¿ï¼‰
mypage.js - ãƒã‚¤ãƒšãƒ¼ã‚¸æ©Ÿèƒ½


---

`public/index.html` : ï¼ˆãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ï¼‰

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èª¿æŸ»ã‚·ã‚¹ãƒ†ãƒ </title>
    
    <!-- MapLibre GL JS -->
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    
    <!-- å…±é€šã‚¹ã‚¿ã‚¤ãƒ« -->
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
        <div class="header-container">
            <h1 class="header-title">
                <a href="/">ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èª¿æŸ»ã‚·ã‚¹ãƒ†ãƒ </a>
            </h1>
            <nav class="header-nav">
                <div id="nav-not-logged-in" class="nav-group" style="display: none;">
                    <a href="/login/" class="btn btn-outline">ãƒ­ã‚°ã‚¤ãƒ³</a>
                    <a href="/signup/" class="btn btn-primary">ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—</a>
                </div>
                <div id="nav-logged-in" class="nav-group" style="display: none;">
                    <span class="username" id="current-username"></span>
                    <a href="/mypage/" class="btn btn-outline">ãƒã‚¤ãƒšãƒ¼ã‚¸</a>
                    <button id="logout-btn" class="btn btn-danger">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="main-container">
        <!-- åœ°å›³ã‚¨ãƒªã‚¢ -->
        <div id="map" class="map-container"></div>
        
        <!-- ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ« -->
        <aside class="side-panel">
            <h2>æŠ•ç¨¿ä¸€è¦§</h2>
            <div id="posts-list" class="posts-list">
                <p class="loading">èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        </aside>
    </main>

    <!-- æŠ•ç¨¿ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="post-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>æ–°è¦æŠ•ç¨¿</h2>
            <form id="post-form">
                <div class="form-group">
                    <label>ä½ç½®æƒ…å ±</label>
                    <p>ç·¯åº¦: <span id="modal-lat"></span></p>
                    <p>çµŒåº¦: <span id="modal-lng"></span></p>
                </div>
                
                <div class="form-group">
                    <label for="post-comment">ã‚³ãƒ¡ãƒ³ãƒˆ</label>
                    <textarea id="post-comment" rows="4" maxlength="1000" placeholder="å ´æ‰€ã®èª¬æ˜ã‚„è¦³å¯Ÿå†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="post-image">ç”»åƒ</label>
                    <input type="file" id="post-image" accept="image/jpeg,image/jpg,image/png,image/gif">
                    <div id="image-preview" class="image-preview"></div>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn btn-outline" id="cancel-post">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="submit" class="btn btn-primary">æŠ•ç¨¿ã™ã‚‹</button>
                </div>
            </form>
        </div>
    </div>

    <!-- å…±é€šã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script src="/js/common.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/map.js"></script>
</body>
</html>
```


---

`public/login/index.html``` : ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ï¼‰

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ­ã‚°ã‚¤ãƒ³ - ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èª¿æŸ»ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f5f5f5;
        }
        
        .auth-box {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }
        
        .auth-title {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .auth-link {
            text-align: center;
            margin-top: 1rem;
            color: #6b7280;
        }
        
        .auth-link a {
            color: #2563eb;
            text-decoration: none;
        }
        
        .auth-link a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
        <div class="header-container">
            <h1 class="header-title">
                <a href="/">ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èª¿æŸ»ã‚·ã‚¹ãƒ†ãƒ </a>
            </h1>
            <nav class="header-nav">
                <div id="nav-not-logged-in" class="nav-group">
                    <a href="/login/" class="btn btn-outline">ãƒ­ã‚°ã‚¤ãƒ³</a>
                    <a href="/signup/" class="btn btn-primary">ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—</a>
                </div>
            </nav>
        </div>
    </header>

    <!-- ãƒ­ã‚°ã‚¤ãƒ³ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="auth-container">
        <div class="auth-box">
            <h2 class="auth-title">ãƒ­ã‚°ã‚¤ãƒ³</h2>
            
            <form id="login-form">
                <div class="form-group">
                    <label for="user-id">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID</label>
                    <input type="text" id="user-id" required autofocus>
                </div>
                
                <div class="form-group">
                    <label for="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                    <input type="password" id="password" required>
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">ãƒ­ã‚°ã‚¤ãƒ³</button>
                </div>
            </form>
            
            <div class="auth-link">
                ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã§ãªã„æ–¹ã¯ <a href="/signup/">ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—</a>
            </div>
        </div>
    </div>

    <script src="/js/common.js"></script>
    <script src="/js/auth.js"></script>
    <script>
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const userId = document.getElementById('user-id').value;
            const password = document.getElementById('password').value;
            const submitButton = e.target.querySelector('button[type="submit"]');
            
            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            submitButton.disabled = true;
            submitButton.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³ä¸­...';
            
            const result = await login(userId, password);
            
            if (result.success) {
                window.location.href = '/';
            } else {
                showError(result.error, e.target);
                submitButton.disabled = false;
                submitButton.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³';
            }
        });
    </script>
</body>
</html>
```


---

`public/signup/index.html`:ï¼ˆã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒšãƒ¼ã‚¸ï¼‰

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ— - ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èª¿æŸ»ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .auth-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f5f5f5;
        }
        
        .auth-box {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
        }
        
        .auth-title {
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .auth-link {
            text-align: center;
            margin-top: 1rem;
            color: #6b7280;
        }
        
        .auth-link a {
            color: #2563eb;
            text-decoration: none;
        }
        
        .auth-link a:hover {
            text-decoration: underline;
        }
        
        .help-text {
            font-size: 0.875rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
    </style>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
        <div class="header-container">
            <h1 class="header-title">
                <a href="/">ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èª¿æŸ»ã‚·ã‚¹ãƒ†ãƒ </a>
            </h1>
            <nav class="header-nav">
                <div id="nav-not-logged-in" class="nav-group">
                    <a href="/login/" class="btn btn-outline">ãƒ­ã‚°ã‚¤ãƒ³</a>
                    <a href="/signup/" class="btn btn-primary">ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—</a>
                </div>
            </nav>
        </div>
    </header>

    <!-- ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="auth-container">
        <div class="auth-box">
            <h2 class="auth-title">ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—</h2>
            
            <form id="signup-form">
                <div class="form-group">
                    <label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹</label>
                    <input type="email" id="email" required autofocus>
                </div>
                
                <div class="form-group">
                    <label for="user-id">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID</label>
                    <input type="text" id="user-id" required pattern="[a-zA-Z0-9_-]{3,}" title="3æ–‡å­—ä»¥ä¸Šã®è‹±æ•°å­—ã€ãƒã‚¤ãƒ•ãƒ³ã€ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢ã®ã¿">
                    <p class="help-text">3æ–‡å­—ä»¥ä¸Šã®è‹±æ•°å­—ã€ãƒã‚¤ãƒ•ãƒ³(-)ã€ã‚¢ãƒ³ãƒ€ãƒ¼ã‚¹ã‚³ã‚¢(_)ãŒä½¿ç”¨ã§ãã¾ã™</p>
                </div>
                
                <div class="form-group">
                    <label for="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
                    <input type="password" id="password" required minlength="6">
                    <p class="help-text">6æ–‡å­—ä»¥ä¸Šã§è¨­å®šã—ã¦ãã ã•ã„</p>
                </div>
                
                <div class="form-group">
                    <label for="password-confirm">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆç¢ºèªï¼‰</label>
                    <input type="password" id="password-confirm" required minlength="6">
                </div>
                
                <div class="form-group">
                    <button type="submit" class="btn btn-primary" style="width: 100%;">ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ</button>
                </div>
            </form>
            
            <div class="auth-link">
                æ—¢ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã®æ–¹ã¯ <a href="/login/">ãƒ­ã‚°ã‚¤ãƒ³</a>
            </div>
        </div>
    </div>

    <script src="/js/common.js"></script>
    <script src="/js/auth.js"></script>
    <script>
        document.getElementById('signup-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            const userId = document.getElementById('user-id').value;
            const password = document.getElementById('password').value;
            const passwordConfirm = document.getElementById('password-confirm').value;
            const submitButton = e.target.querySelector('button[type="submit"]');
            
            // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç¢ºèª
            if (password !== passwordConfirm) {
                showError('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒä¸€è‡´ã—ã¾ã›ã‚“', e.target);
                return;
            }
            
            // ãƒœã‚¿ãƒ³ã‚’ç„¡åŠ¹åŒ–
            submitButton.disabled = true;
            submitButton.textContent = 'ä½œæˆä¸­...';
            
            const result = await signup(email, userId, password);
            
            if (result.success) {
                showSuccess('ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä½œæˆã•ã‚Œã¾ã—ãŸï¼');
                setTimeout(() => {
                    window.location.href = '/';
                }, 1000);
            } else {
                showError(result.error, e.target);
                submitButton.disabled = false;
                submitButton.textContent = 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ';
            }
        });
    </script>
</body>
</html>

```



---

`public/mypage/index.html`:ï¼ˆãƒã‚¤ãƒšãƒ¼ã‚¸ï¼‰

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒã‚¤ãƒšãƒ¼ã‚¸ - ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èª¿æŸ»ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .mypage-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .user-info {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }
        
        .user-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .stat-card {
            background: #f3f4f6;
            padding: 1rem;
            border-radius: 0.375rem;
            text-align: center;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: #2563eb;
        }
        
        .stat-label {
            color: #6b7280;
            font-size: 0.875rem;
        }
        
        .my-posts {
            background: white;
            padding: 2rem;
            border-radius: 0.5rem;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .posts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .post-card {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            overflow: hidden;
            transition: all 0.2s;
        }
        
        .post-card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .post-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background-color: #f3f4f6;
        }
        
        .post-content {
            padding: 1rem;
        }
        
        .post-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .btn-small {
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
        <div class="header-container">
            <h1 class="header-title">
                <a href="/">ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰èª¿æŸ»ã‚·ã‚¹ãƒ†ãƒ </a>
            </h1>
            <nav class="header-nav">
                <div id="nav-not-logged-in" class="nav-group" style="display: none;">
                    <a href="/login/" class="btn btn-outline">ãƒ­ã‚°ã‚¤ãƒ³</a>
                    <a href="/signup/" class="btn btn-primary">ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—</a>
                </div>
                <div id="nav-logged-in" class="nav-group" style="display: none;">
                    <span class="username" id="current-username"></span>
                    <a href="/mypage/" class="btn btn-outline">ãƒã‚¤ãƒšãƒ¼ã‚¸</a>
                    <button id="logout-btn" class="btn btn-danger">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- ãƒã‚¤ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <div class="mypage-container">
        <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ± -->
        <div class="user-info">
            <h2>ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±</h2>
            <div id="user-details">
                <p class="loading">èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        </div>

        <!-- è‡ªåˆ†ã®æŠ•ç¨¿ -->
        <div class="my-posts">
            <h2>æŠ•ç¨¿ä¸€è¦§</h2>
            <div id="my-posts-grid" class="posts-grid">
                <p class="loading">èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        </div>
    </div>

    <script src="/js/common.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/mypage.js"></script>
</body>
</html>
```


---


JSéƒ¨åˆ†ã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚
ã‚µãƒ³ãƒ—ãƒ«ã§æç¤ºã—ãŸã‚‚ã®ã¨ç•°ãªã£ã¦ã€
å…±é€šã‹ã§ãã‚‹éƒ¨å“ãŒå¤šãã‚ã‚‹ã®ã§ã€ã“ã‚Œã‚’ç¹°ã‚Šè¿”ã—ä½¿ãˆã‚‹ã‚ˆã†ã«åˆ‡ã‚Šå‡ºã—ã¦ã„ãã¾ã™ã€‚
ã¾ãŸã€ãã‚Œã«ä¼´ã£ã¦ã€ç‰¹å®šã®ãƒšãƒ¼ã‚¸ã§ã—ã‹ä½¿ã‚ãªã„ã‚³ãƒ¼ãƒ‰ã‚‚å˜ä¸€ã®JSãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦åˆ‡ã‚Šå‡ºã—ã¾ã™ã€‚

---

```sh
mkdir -p public/{login,signup,mypage,js,css}
```

---

`public/js/common.js`

```js
// å…±é€šé–¢æ•°ã¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

// API ã®ãƒ™ãƒ¼ã‚¹URL
const API_BASE_URL = '/api';

// ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ã‚­ãƒ¼
const TOKEN_KEY = 'auth_token';
const USER_KEY = 'user_info';

// èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—
function getAuthToken() {
    return localStorage.getItem(TOKEN_KEY);
}

// èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®ä¿å­˜
function setAuthToken(token) {
    localStorage.setItem(TOKEN_KEY, token);
}

// èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã®å‰Šé™¤
function removeAuthToken() {
    localStorage.removeItem(TOKEN_KEY);
    localStorage.removeItem(USER_KEY);
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—
function getUserInfo() {
    const userStr = localStorage.getItem(USER_KEY);
    return userStr ? JSON.parse(userStr) : null;
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®ä¿å­˜
function setUserInfo(user) {
    localStorage.setItem(USER_KEY, JSON.stringify(user));
}

// APIãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ˜ãƒƒãƒ€ãƒ¼ç”Ÿæˆ
function getAuthHeaders() {
    const token = getAuthToken();
    const headers = {
        'Content-Type': 'application/json',
    };
    
    if (token) {
        headers['Authorization'] = `Bearer ${token}`;
    }
    
    return headers;
}

// æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
function formatDate(dateString) {
    const date = new Date(dateString);
    const now = new Date();
    const diff = now - date;
    
    // 1åˆ†ä»¥å†…
    if (diff < 60000) {
        return 'ãŸã£ãŸä»Š';
    }
    // 1æ™‚é–“ä»¥å†…
    if (diff < 3600000) {
        const minutes = Math.floor(diff / 60000);
        return `${minutes}åˆ†å‰`;
    }
    // 24æ™‚é–“ä»¥å†…
    if (diff < 86400000) {
        const hours = Math.floor(diff / 3600000);
        return `${hours}æ™‚é–“å‰`;
    }
    // 7æ—¥ä»¥å†…
    if (diff < 604800000) {
        const days = Math.floor(diff / 86400000);
        return `${days}æ—¥å‰`;
    }
    
    // ãã‚Œä»¥å¤–ã¯æ—¥ä»˜è¡¨ç¤º
    return date.toLocaleDateString('ja-JP');
}

// ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º
function showError(message, targetElement) {
    const errorDiv = document.createElement('div');
    errorDiv.className = 'error';
    errorDiv.textContent = message;
    
    if (targetElement) {
        // æ—¢å­˜ã®ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
        const existingError = targetElement.querySelector('.error');
        if (existingError) {
            existingError.remove();
        }
        targetElement.appendChild(errorDiv);
        
        // 5ç§’å¾Œã«è‡ªå‹•å‰Šé™¤
        setTimeout(() => {
            errorDiv.remove();
        }, 5000);
    } else {
        alert(message);
    }
}

// æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º
function showSuccess(message, targetElement) {
    const successDiv = document.createElement('div');
    successDiv.className = 'success';
    successDiv.textContent = message;
    
    if (targetElement) {
        // æ—¢å­˜ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤
        const existingMessage = targetElement.querySelector('.success, .error');
        if (existingMessage) {
            existingMessage.remove();
        }
        targetElement.appendChild(successDiv);
        
        // 3ç§’å¾Œã«è‡ªå‹•å‰Šé™¤
        setTimeout(() => {
            successDiv.remove();
        }, 3000);
    } else {
        alert(message);
    }
}

// ãƒ˜ãƒƒãƒ€ãƒ¼ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®æ›´æ–°
function updateNavigation() {
    const notLoggedIn = document.getElementById('nav-not-logged-in');
    const loggedIn = document.getElementById('nav-logged-in');
    const usernameSpan = document.getElementById('current-username');
    
    // è¦ç´ ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯æ—©æœŸãƒªã‚¿ãƒ¼ãƒ³
    if (!notLoggedIn || !loggedIn) {
        console.warn('Navigation elements not found');
        return;
    }
    
    const user = getUserInfo();
    
    if (user) {
        // ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿
        notLoggedIn.style.display = 'none';
        loggedIn.style.display = 'flex';
        if (usernameSpan) {
            usernameSpan.textContent = user.user_id;
        }
    } else {
        // æœªãƒ­ã‚°ã‚¤ãƒ³
        notLoggedIn.style.display = 'flex';
        loggedIn.style.display = 'none';
    }
}

// HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
function escapeHtml(str) {
    const div = document.createElement('div');
    div.textContent = str;
    return div.innerHTML;
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®åˆæœŸåŒ–
document.addEventListener('DOMContentLoaded', () => {
    updateNavigation();
    
    // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆ
    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', () => {
            if (confirm('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã™ã‹ï¼Ÿ')) {
                removeAuthToken();
                window.location.href = '/';
            }
        });
    }
});
```

---

`public/js/auth.js`

```js

// èªè¨¼é–¢é€£ã®é–¢æ•°

// ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯ã¨èªè¨¼ãŒå¿…è¦ãªãƒšãƒ¼ã‚¸ã§ã®ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
function requireAuth() {
    const token = getAuthToken();
    if (!token) {
        window.location.href = '/login/';
        return false;
    }
    return true;
}

// ãƒˆãƒ¼ã‚¯ãƒ³ã®æ¤œè¨¼
async function verifyToken() {
    const token = getAuthToken();
    if (!token) return false;
    
    try {
        const response = await fetch(`${API_BASE_URL}/auth/verify`, {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            return data.valid;
        }
        
        // ãƒˆãƒ¼ã‚¯ãƒ³ãŒç„¡åŠ¹ãªå ´åˆã¯ã‚¯ãƒªã‚¢
        removeAuthToken();
        return false;
    } catch (error) {
        console.error('Token verification error:', error);
        return false;
    }
}

// ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
async function login(userId, password) {
    try {
        const response = await fetch(`${API_BASE_URL}/auth/login`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                user_id: userId,
                password: password
            })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            setAuthToken(data.token);
            setUserInfo(data.user);
            return { success: true };
        } else {
            return { success: false, error: data.message || 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ' };
        }
    } catch (error) {
        console.error('Login error:', error);
        return { success: false, error: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' };
    }
}

// ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†
async function signup(email, userId, password) {
    try {
        const response = await fetch(`${API_BASE_URL}/auth/signup`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                email: email,
                user_id: userId,
                password: password
            })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            setAuthToken(data.token);
            setUserInfo(data.user);
            return { success: true };
        } else {
            // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã®å‡¦ç†
            if (data.errors) {
                const errorMessages = data.errors.map(err => err.msg).join('\n');
                return { success: false, error: errorMessages };
            }
            return { success: false, error: data.message || 'ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ã«å¤±æ•—ã—ã¾ã—ãŸ' };
        }
    } catch (error) {
        console.error('Signup error:', error);
        return { success: false, error: 'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ' };
    }
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—
async function fetchUserInfo() {
    try {
        const response = await fetch(`${API_BASE_URL}/users/me`, {
            headers: getAuthHeaders()
        });
        
        if (response.ok) {
            const data = await response.json();
            setUserInfo(data.user);
            return data.user;
        }
        
        return null;
    } catch (error) {
        console.error('Fetch user info error:', error);
        return null;
    }
}
```

---

CSSã«ã¤ã„ã¦ã‚‚åŒæ§˜ã«åˆ‡ã‚Šå‡ºã—ã¦ãŠãã€å…±é€šã‚«ã‚¿ãƒ­ã‚°(ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³)ã¨ã—ã¦ä½œã£ã¦ãŠã„ã¦ã€æ›¸ãhtmlã‹ã‚‰å¿…è¦ãªéƒ¨åˆ†ã ã‘åˆ©ç”¨ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```css
/* ãƒªã‚»ãƒƒãƒˆã¨ãƒ™ãƒ¼ã‚¹è¨­å®š */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    line-height: 1.6;
    color: #333;
    background-color: #f5f5f5;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼ */
.header {
    background-color: #fff;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    position: sticky;
    top: 0;
    z-index: 1000;
}

.header-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-title {
    font-size: 1.5rem;
    font-weight: bold;
}

.header-title a {
    color: #2563eb;
    text-decoration: none;
}

.header-nav {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.nav-group {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.username {
    font-weight: 500;
    color: #666;
}

/* ãƒœã‚¿ãƒ³ */
.btn {
    padding: 0.5rem 1rem;
    border: none;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    font-weight: 500;
    cursor: pointer;
    text-decoration: none;
    display: inline-block;
    transition: all 0.2s;
}

.btn-primary {
    background-color: #2563eb;
    color: white;
}

.btn-primary:hover {
    background-color: #1d4ed8;
}

.btn-outline {
    background-color: white;
    color: #2563eb;
    border: 1px solid #2563eb;
}

.btn-outline:hover {
    background-color: #eff6ff;
}

.btn-danger {
    background-color: #dc2626;
    color: white;
}

.btn-danger:hover {
    background-color: #b91c1c;
}

/* ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒŠ */
.main-container {
    display: flex;
    height: calc(100vh - 80px);
    position: relative;
}

/* åœ°å›³ */
.map-container {
    flex: 1;
    position: relative;
}

/* ã‚µã‚¤ãƒ‰ãƒ‘ãƒãƒ« */
.side-panel {
    width: 400px;
    background-color: white;
    box-shadow: -2px 0 4px rgba(0,0,0,0.1);
    overflow-y: auto;
    padding: 1.5rem;
}

.side-panel h2 {
    font-size: 1.25rem;
    margin-bottom: 1rem;
}

/* æŠ•ç¨¿ãƒªã‚¹ãƒˆ */
.posts-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.post-item {
    padding: 1rem;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    cursor: pointer;
    transition: all 0.2s;
}

.post-item:hover {
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.post-item.selected {
    border-color: #2563eb;
    background-color: #eff6ff;
    box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
}

.post-header {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
}

.post-user {
    font-weight: 500;
    color: #2563eb;
}

.post-date {
    font-size: 0.875rem;
    color: #6b7280;
}

.post-comment {
    margin-bottom: 0.5rem;
    word-wrap: break-word;
}

.post-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
    border-radius: 0.375rem;
}

.loading {
    text-align: center;
    color: #6b7280;
}

/* ãƒ¢ãƒ¼ãƒ€ãƒ« */
.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}

.modal-content {
    background-color: white;
    padding: 2rem;
    border-radius: 0.5rem;
    max-width: 500px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
}

.modal-close {
    position: absolute;
    top: 1rem;
    right: 1rem;
    font-size: 1.5rem;
    cursor: pointer;
    color: #6b7280;
}

.modal-close:hover {
    color: #374151;
}

/* ãƒ•ã‚©ãƒ¼ãƒ  */
.form-group {
    margin-bottom: 1.5rem;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.form-group input[type="text"],
.form-group input[type="email"],
.form-group input[type="password"],
.form-group textarea {
    width: 100%;
    padding: 0.5rem;
    border: 1px solid #d1d5db;
    border-radius: 0.375rem;
    font-size: 1rem;
}

.form-group textarea {
    resize: vertical;
}

.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
}

.image-preview {
    margin-top: 1rem;
}

.image-preview img {
    max-width: 100%;
    max-height: 300px;
    border-radius: 0.375rem;
}

/* ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */
.error {
    color: #dc2626;
    font-size: 0.875rem;
    margin-top: 0.25rem;
}

.success {
    color: #059669;
    font-size: 0.875rem;
    margin-top: 0.25rem;
}

/* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– */
@media (max-width: 768px) {
    .main-container {
        flex-direction: column;
    }
    
    .side-panel {
        width: 100%;
        height: 300px;
        box-shadow: 0 -2px 4px rgba(0,0,0,0.1);
    }
    
    .header-container {
        padding: 1rem;
    }
    
    .modal-content {
        padding: 1.5rem;
    }
}
```


---

`public/js/map.js`
```js
// åœ°å›³é–¢é€£ã®æ©Ÿèƒ½ï¼ˆPhase 3ã§å®Œå…¨å®Ÿè£…ï¼‰

let map;
let posts = [];

// åœ°å›³ã®åˆæœŸåŒ–ï¼ˆæš«å®šï¼‰
function initMap() {
    // Phase 3ã§å®Ÿè£…
    console.log('Map will be initialized in Phase 3');
    
    // ã¨ã‚Šã‚ãˆãšæŠ•ç¨¿ä¸€è¦§ã ã‘èª­ã¿è¾¼ã‚€
    loadPosts();
}

// æŠ•ç¨¿ã®èª­ã¿è¾¼ã¿
async function loadPosts() {
    try {
        const response = await fetch(`${API_BASE_URL}/posts`);
        const data = await response.json();
        
        if (response.ok) {
            posts = data.posts;
            displayPosts(data.posts);
        }
    } catch (error) {
        console.error('Load posts error:', error);
        showError('æŠ•ç¨¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
}

// æŠ•ç¨¿ä¸€è¦§ã®è¡¨ç¤º
function displayPosts(posts) {
    const postsList = document.getElementById('posts-list');
    
    if (!postsList) return;
    
    if (posts.length === 0) {
        postsList.innerHTML = '<p class="loading">æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
    }
    
    postsList.innerHTML = posts.map(post => `
        <div class="post-item" data-post-id="${post.id}">
            <div class="post-header">
                <span class="post-user">${escapeHtml(post.username)}</span>
                <span class="post-date">${formatDate(post.created_at)}</span>
            </div>
            ${post.comment ? `<p class="post-comment">${escapeHtml(post.comment)}</p>` : ''}
            ${post.image_url ? `<img src="${post.image_url}" alt="æŠ•ç¨¿ç”»åƒ" class="post-image">` : ''}
        </div>
    `).join('');
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚
document.addEventListener('DOMContentLoaded', () => {
    if (document.getElementById('map')) {
        initMap();
    }
});
```


---

`public/js/mypage.js`

```js
// ãƒã‚¤ãƒšãƒ¼ã‚¸æ©Ÿèƒ½

// èªè¨¼ãƒã‚§ãƒƒã‚¯
if (!requireAuth()) {
    // requireAuthå†…ã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã‚‹
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®èª­ã¿è¾¼ã¿
async function loadUserInfo() {
    try {
        const [userResponse, statsResponse] = await Promise.all([
            fetch(`${API_BASE_URL}/users/me`, { headers: getAuthHeaders() }),
            fetch(`${API_BASE_URL}/users/me/stats`, { headers: getAuthHeaders() })
        ]);

        if (userResponse.ok && statsResponse.ok) {
            const userData = await userResponse.json();
            const statsData = await statsResponse.json();
            
            displayUserInfo(userData.user, statsData.stats);
        }
    } catch (error) {
        console.error('Load user info error:', error);
        showError('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
}

// ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®è¡¨ç¤º
function displayUserInfo(user, stats) {
    const userDetails = document.getElementById('user-details');
    userDetails.innerHTML = `
        <p><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼ID:</strong> ${user.user_id}</p>
        <p><strong>ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</strong> ${user.email}</p>
        <p><strong>ç™»éŒ²æ—¥:</strong> ${new Date(user.created_at).toLocaleDateString('ja-JP')}</p>
        
        <div class="user-stats">
            <div class="stat-card">
                <div class="stat-value">${stats.total_posts}</div>
                <div class="stat-label">ç·æŠ•ç¨¿æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value">${stats.posts_with_images}</div>
                <div class="stat-label">ç”»åƒä»˜ãæŠ•ç¨¿</div>
            </div>
        </div>
    `;
}

// è‡ªåˆ†ã®æŠ•ç¨¿ã®èª­ã¿è¾¼ã¿
async function loadMyPosts() {
    try {
        const user = getUserInfo();
        const response = await fetch(`${API_BASE_URL}/posts/user/${user.user_id}`, {
            headers: getAuthHeaders()
        });

        if (response.ok) {
            const data = await response.json();
            displayMyPosts(data.posts);
        }
    } catch (error) {
        console.error('Load my posts error:', error);
        showError('æŠ•ç¨¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
}

// æŠ•ç¨¿ã®è¡¨ç¤º
function displayMyPosts(posts) {
    const postsGrid = document.getElementById('my-posts-grid');
    
    if (posts.length === 0) {
        postsGrid.innerHTML = '<p>ã¾ã æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
    }

    postsGrid.innerHTML = posts.map(post => `
        <div class="post-card" data-post-id="${post.id}">
            ${post.image_url ? 
                `<img src="${post.image_url}" alt="æŠ•ç¨¿ç”»åƒ" class="post-image">` : 
                '<div class="post-image" style="display: flex; align-items: center; justify-content: center; color: #9ca3af;">ç”»åƒãªã—</div>'
            }
            <div class="post-content">
                <p class="post-date">${formatDate(post.created_at)}</p>
                <p class="post-comment">${escapeHtml(post.comment || 'ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆãªã—ï¼‰')}</p>
                <p style="font-size: 0.875rem; color: #6b7280;">
                    ç·¯åº¦: ${post.latitude.toFixed(6)}, çµŒåº¦: ${post.longitude.toFixed(6)}
                </p>
                <div class="post-actions">
                    <button class="btn btn-outline btn-small" onclick="viewOnMap(${post.latitude}, ${post.longitude})">
                        åœ°å›³ã§è¦‹ã‚‹
                    </button>
                    <button class="btn btn-danger btn-small" onclick="deletePost(${post.id})">
                        å‰Šé™¤
                    </button>
                </div>
            </div>
        </div>
    `).join('');
}

// åœ°å›³ã§è¡¨ç¤ºï¼ˆãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«é·ç§»ï¼‰
function viewOnMap(lat, lng) {
    // ä½ç½®æƒ…å ±ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ä¿å­˜
    sessionStorage.setItem('focusLocation', JSON.stringify({ lat, lng }));
    window.location.href = '/';
}

// æŠ•ç¨¿ã®å‰Šé™¤
async function deletePost(postId) {
    if (!confirm('ã“ã®æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) {
        return;
    }

    try {
        const response = await fetch(`${API_BASE_URL}/posts/${postId}`, {
            method: 'DELETE',
            headers: getAuthHeaders()
        });

        if (response.ok) {
            showSuccess('æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            loadMyPosts(); // å†èª­ã¿è¾¼ã¿
        } else {
            const data = await response.json();
            showError(data.message || 'å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ');
        }
    } catch (error) {
        console.error('Delete post error:', error);
        showError('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
    }
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚
document.addEventListener('DOMContentLoaded', () => {
    updateNavigation();
    loadUserInfo();
    loadMyPosts();
});
```

---



### ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
```sh
npm run dev
```

### ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹

http://localhost:3000/ - ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
http://localhost:3000/login/ - ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸
http://localhost:3000/signup/ - ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒšãƒ¼ã‚¸
http://localhost:3000/mypage/ - ãƒã‚¤ãƒšãƒ¼ã‚¸ï¼ˆè¦ãƒ­ã‚°ã‚¤ãƒ³ï¼‰


---

# åœ°å›³å‘¨ã‚Šã®æ©Ÿèƒ½ã‚’è©°ã‚ã‚‹

---
`public/js/map.js`ã‚’æ‹¡å¼µ

```
// åœ°å›³é–¢é€£ã®æ©Ÿèƒ½

let map;
let markers = [];
let selectedLocation = null;
let selectedPostId = null;
let isMarkerClick = false;

// åœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«ã®å®šç¾©
const mapStyles = {
    'osm-bright': {
        name: 'OpenStreetMap',
        style: 'https://tile.openstreetmap.jp/styles/osm-bright-ja/style.json'
    },
    'osm-standard': {
        name: 'OSM Standard',
        style: {
            version: 8,
            sources: {
                'osm-tiles': {
                    type: 'raster',
                    tiles: ['https://tile.openstreetmap.org/{z}/{x}/{y}.png'],
                    tileSize: 256,
                    attribution: 'Â© OpenStreetMap contributors'
                }
            },
            layers: [{
                id: 'osm-tiles',
                type: 'raster',
                source: 'osm-tiles',
                minzoom: 0,
                maxzoom: 19
            }]
        }
    },
    'esri-satellite': {
        name: 'ESRI è¡›æ˜Ÿå†™çœŸ',
        style: {
            version: 8,
            sources: {
                'esri-satellite': {
                    type: 'raster',
                    tiles: ['https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'],
                    tileSize: 256,
                    attribution: 'Â© Esri'
                }
            },
            layers: [{
                id: 'esri-satellite',
                type: 'raster',
                source: 'esri-satellite',
                minzoom: 0,
                maxzoom: 19
            }]
        }
    }
};

let currentStyle = 'osm-bright';

// åœ°å›³ã®åˆæœŸåŒ–
function initMap() {
    // MapLibre GL JSã®åˆæœŸåŒ–ï¼ˆå®‡éƒ¨å¸‚ã‚’ä¸­å¿ƒã«ï¼‰
    map = new maplibregl.Map({
        container: 'map',
        style: mapStyles[currentStyle].style,
        center: [131.2463, 33.9980], // å®‡éƒ¨å¸‚ã®åº§æ¨™
        zoom: 12
    });

    // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«è¿½åŠ 
    map.addControl(new maplibregl.NavigationControl());

    // ç¾åœ¨åœ°ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«è¿½åŠ 
    map.addControl(
        new maplibregl.GeolocateControl({
            positionOptions: {
                enableHighAccuracy: true
            },
            trackUserLocation: true
        })
    );

    // ã‚¹ã‚¿ã‚¤ãƒ«åˆ‡ã‚Šæ›¿ãˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®è¿½åŠ 
    createStyleControl();

    // åœ°å›³ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
    map.on('click', (e) => {
        // ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒªãƒƒã‚¯ã®å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
        if (isMarkerClick) {
            isMarkerClick = false;
            return;
        }

        const user = getUserInfo();
        if (!user) {
            if (confirm('æŠ•ç¨¿ã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ç§»å‹•ã—ã¾ã™ã‹ï¼Ÿ')) {
                window.location.href = '/login/';
            }
            return;
        }

        selectedLocation = {
            lat: e.lngLat.lat,
            lng: e.lngLat.lng
        };
        
        showPostModal(selectedLocation);
    });

    // åœ°å›³èª­ã¿è¾¼ã¿å®Œäº†å¾Œ
    map.on('load', () => {
        loadPosts();
        
        // ãƒã‚¤ãƒšãƒ¼ã‚¸ã‹ã‚‰ã®é·ç§»ãƒã‚§ãƒƒã‚¯
        const focusLocation = sessionStorage.getItem('focusLocation');
        if (focusLocation) {
            const location = JSON.parse(focusLocation);
            setTimeout(() => {
                focusOnPost(location.lat, location.lng);
            }, 1000);
            sessionStorage.removeItem('focusLocation');
        }
    });
}

// ã‚¹ã‚¿ã‚¤ãƒ«åˆ‡ã‚Šæ›¿ãˆã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®ä½œæˆ
function createStyleControl() {
    const control = document.createElement('div');
    control.className = 'maplibregl-ctrl maplibregl-ctrl-group';
    control.style.marginTop = '10px';
    
    const select = document.createElement('select');
    select.style.padding = '5px';
    select.style.fontSize = '12px';
    select.style.cursor = 'pointer';
    
    Object.entries(mapStyles).forEach(([key, value]) => {
        const option = document.createElement('option');
        option.value = key;
        option.textContent = value.name;
        if (key === currentStyle) option.selected = true;
        select.appendChild(option);
    });
    
    select.addEventListener('change', (e) => {
        switchMapStyle(e.target.value);
    });
    
    control.appendChild(select);
    map.addControl({
        onAdd: () => control,
        onRemove: () => {}
    }, 'top-right');
}

// åœ°å›³ã‚¹ã‚¿ã‚¤ãƒ«ã®åˆ‡ã‚Šæ›¿ãˆ
function switchMapStyle(styleKey) {
    if (!mapStyles[styleKey]) return;
    
    currentStyle = styleKey;
    const center = map.getCenter();
    const zoom = map.getZoom();
    
    // æ—¢å­˜ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’ä¸€æ™‚ä¿å­˜
    const tempMarkers = markers.map(marker => ({
        lngLat: marker.getLngLat(),
        popup: marker.getPopup()
    }));
    
    // ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å¤‰æ›´
    map.setStyle(mapStyles[styleKey].style);
    
    // ã‚¹ã‚¿ã‚¤ãƒ«èª­ã¿è¾¼ã¿å®Œäº†å¾Œã«ãƒãƒ¼ã‚«ãƒ¼ã‚’å¾©å…ƒ
    map.once('style.load', () => {
        // ä½ç½®ã¨ã‚ºãƒ¼ãƒ ã‚’å¾©å…ƒ
        map.jumpTo({ center, zoom });
        
        // ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚¯ãƒªã‚¢
        markers.forEach(marker => marker.remove());
        markers = [];
        
        // æŠ•ç¨¿ã‚’å†èª­ã¿è¾¼ã¿
        loadPosts();
    });
}

// æŠ•ç¨¿ã®èª­ã¿è¾¼ã¿ã¨è¡¨ç¤º
async function loadPosts() {
    try {
        const response = await fetch(`${API_BASE_URL}/posts`);
        const data = await response.json();
        
        if (response.ok) {
            displayPosts(data.posts);
            addMarkersToMap(data.posts);
        }
    } catch (error) {
        console.error('Load posts error:', error);
        showError('æŠ•ç¨¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
    }
}

// æŠ•ç¨¿ä¸€è¦§ã®è¡¨ç¤º
function displayPosts(posts) {
    const postsList = document.getElementById('posts-list');
    
    if (posts.length === 0) {
        postsList.innerHTML = '<p class="loading">æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“</p>';
        return;
    }
    
    postsList.innerHTML = posts.map(post => `
        <div class="post-item ${selectedPostId === post.id ? 'selected' : ''}" 
             data-post-id="${post.id}" 
             onclick="selectPost(${post.id}, ${post.latitude}, ${post.longitude})">
            <div class="post-header">
                <span class="post-user">${escapeHtml(post.username)}</span>
                <span class="post-date">${formatDate(post.created_at)}</span>
            </div>
            ${post.comment ? `<p class="post-comment">${escapeHtml(post.comment)}</p>` : ''}
            ${post.image_url ? `<img src="${post.image_url}" alt="æŠ•ç¨¿ç”»åƒ" class="post-image">` : ''}
        </div>
    `).join('');
}

// æŠ•ç¨¿ã‚’é¸æŠ
function selectPost(postId, lat, lng) {
    selectedPostId = postId;
    
    // é¸æŠçŠ¶æ…‹ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ›´æ–°
    document.querySelectorAll('.post-item').forEach(item => {
        item.classList.remove('selected');
    });
    document.querySelector(`[data-post-id="${postId}"]`)?.classList.add('selected');
    
    // åœ°å›³ã‚’ç§»å‹•
    focusOnPost(lat, lng);
    
    // å¯¾å¿œã™ã‚‹ãƒãƒ¼ã‚«ãƒ¼ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’è¡¨ç¤º
    const marker = markers.find(m => m.postId === postId);
    if (marker && marker.getPopup()) {
        marker.getPopup().addTo(map);
    }
}

// åœ°å›³ã«ãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
function addMarkersToMap(posts) {
    // æ—¢å­˜ã®ãƒãƒ¼ã‚«ãƒ¼ã‚’ã‚¯ãƒªã‚¢
    markers.forEach(marker => marker.remove());
    markers = [];
    
    posts.forEach(post => {
        // ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ã‚«ãƒ¼è¦ç´ 
        const el = document.createElement('div');
        el.className = 'custom-marker';
        el.style.backgroundColor = post.is_owner ? '#2563eb' : '#ef4444';
        el.style.width = '30px';
        el.style.height = '30px';
        el.style.borderRadius = '50%';
        el.style.cursor = 'pointer';
        el.style.border = '3px solid white';
        el.style.boxShadow = '0 2px 4px rgba(0,0,0,0.3)';
        
        // ã‚µãƒ ãƒã‚¤ãƒ«ä»˜ããƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®å†…å®¹
        const popupContent = `
            <div class="popup-content">
                ${post.image_url ? `<img src="${post.image_url}" alt="æŠ•ç¨¿ç”»åƒ" class="popup-image">` : ''}
                <div class="popup-user">${escapeHtml(post.username)}</div>
                <div class="popup-date">${formatDate(post.created_at)}</div>
                ${post.comment ? `<p class="popup-comment">${escapeHtml(post.comment)}</p>` : ''}
            </div>
        `;
        
        // ãƒãƒ¼ã‚«ãƒ¼ã®ä½œæˆ
        const marker = new maplibregl.Marker(el)
            .setLngLat([post.longitude, post.latitude])
            .setPopup(new maplibregl.Popup({ offset: 25 }).setHTML(popupContent))
            .addTo(map);
        
        // ãƒãƒ¼ã‚«ãƒ¼ã«æŠ•ç¨¿IDã‚’è¿½åŠ 
        marker.postId = post.id;
        
        // ãƒãƒ¼ã‚«ãƒ¼ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
        el.addEventListener('click', (e) => {
            e.stopPropagation();
            isMarkerClick = true;
            selectPost(post.id, post.latitude, post.longitude);
        });
        
        markers.push(marker);
    });
}

// ç‰¹å®šã®æŠ•ç¨¿ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
function focusOnPost(lat, lng) {
    map.flyTo({
        center: [lng, lat],
        zoom: 15,
        duration: 1000
    });
}

// æŠ•ç¨¿ãƒ¢ãƒ¼ãƒ€ãƒ«ã®è¡¨ç¤º
function showPostModal(location) {
    const modal = document.getElementById('post-modal');
    const latSpan = document.getElementById('modal-lat');
    const lngSpan = document.getElementById('modal-lng');
    
    latSpan.textContent = location.lat.toFixed(6);
    lngSpan.textContent = location.lng.toFixed(6);
    
    modal.style.display = 'flex';
    
    // ä¸€æ™‚çš„ãªãƒãƒ¼ã‚«ãƒ¼ã‚’è¿½åŠ 
    const tempMarker = new maplibregl.Marker({ color: '#10b981' })
        .setLngLat([location.lng, location.lat])
        .addTo(map);
    
    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ãŸã¨ãã«ãƒãƒ¼ã‚«ãƒ¼ã‚’å‰Šé™¤
    modal.dataset.tempMarker = markers.length;
    markers.push(tempMarker);
}

// æŠ•ç¨¿ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
function closePostModal() {
    const modal = document.getElementById('post-modal');
    modal.style.display = 'none';
    
    // ãƒ•ã‚©ãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
    document.getElementById('post-form').reset();
    document.getElementById('image-preview').innerHTML = '';
    
    // ä¸€æ™‚çš„ãªãƒãƒ¼ã‚«ãƒ¼ã‚’å‰Šé™¤
    if (modal.dataset.tempMarker) {
        const markerIndex = parseInt(modal.dataset.tempMarker);
        if (markers[markerIndex]) {
            markers[markerIndex].remove();
            markers.splice(markerIndex, 1);
        }
        delete modal.dataset.tempMarker;
    }
}

// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ã®è¨­å®š
document.addEventListener('DOMContentLoaded', () => {
    // åœ°å›³ã®åˆæœŸåŒ–
    if (document.getElementById('map')) {
        initMap();
    }
    
    // ãƒ¢ãƒ¼ãƒ€ãƒ«é–¢é€£ã®ã‚¤ãƒ™ãƒ³ãƒˆ
    const modal = document.getElementById('post-modal');
    const closeBtn = document.querySelector('.modal-close');
    const cancelBtn = document.getElementById('cancel-post');
    const postForm = document.getElementById('post-form');
    const imageInput = document.getElementById('post-image');
    
    if (!modal || !closeBtn || !cancelBtn || !postForm || !imageInput) {
        return; // è¦ç´ ãŒãªã„å ´åˆã¯å‡¦ç†ã—ãªã„
    }
    
    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
    closeBtn.addEventListener('click', closePostModal);
    cancelBtn.addEventListener('click', closePostModal);
    
    // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–å´ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            closePostModal();
        }
    });
    
    // ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
    imageInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        const preview = document.getElementById('image-preview');
        
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                preview.innerHTML = `<img src="${e.target.result}" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼">`;
            };
            reader.readAsDataURL(file);
        } else {
            preview.innerHTML = '';
        }
    });
    
    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
    postForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const formData = new FormData();
        formData.append('latitude', selectedLocation.lat);
        formData.append('longitude', selectedLocation.lng);
        formData.append('comment', document.getElementById('post-comment').value);
        
        const imageFile = document.getElementById('post-image').files[0];
        if (imageFile) {
            formData.append('image', imageFile);
        }
        
        try {
            const response = await fetch(`${API_BASE_URL}/posts`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${getAuthToken()}`
                },
                body: formData
            });
            
            const data = await response.json();
            
            if (response.ok) {
                showSuccess('æŠ•ç¨¿ãŒå®Œäº†ã—ã¾ã—ãŸ');
                closePostModal();
                loadPosts(); // æŠ•ç¨¿ä¸€è¦§ã‚’å†èª­ã¿è¾¼ã¿
            } else {
                showError(data.message || 'æŠ•ç¨¿ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
        } catch (error) {
            console.error('Post error:', error);
            showError('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
        }
    });
});
```

---

`public/css/style.css ` ã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è¿½åŠ 
```css

/* åœ°å›³ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— */
.maplibregl-popup-content {
    padding: 0.5rem;
    min-width: 200px;
    max-width: 300px;
}

.popup-content {
    text-align: center;
}

.popup-image {
    width: 100%;
    height: 150px;
    object-fit: cover;
    border-radius: 0.375rem;
    margin-bottom: 0.5rem;
}

.popup-user {
    font-weight: 500;
    color: #2563eb;
    margin-bottom: 0.25rem;
}

.popup-date {
    font-size: 0.75rem;
    color: #6b7280;
}

.popup-comment {
    margin-top: 0.5rem;
    font-size: 0.875rem;
    text-align: left;
}

/* ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ã‚«ãƒ¼ */
.custom-marker {
    transition: transform 0.2s;
}

.custom-marker:hover {
    transform: scale(1.2);
}

/* åœ°å›³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º */
.maplibregl-ctrl-group select {
    background-color: white;
    border: 1px solid #ddd;
    border-radius: 4px;
    min-width: 120px;
}

.maplibregl-ctrl-group select:hover {
    background-color: #f5f5f5;
}

/* ãƒ¢ãƒã‚¤ãƒ«ã§ã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—èª¿æ•´ */
@media (max-width: 768px) {
    .maplibregl-popup-content {
        max-width: 250px;
    }
    
    .popup-image {
        height: 120px;
    }
}

```


---



Express.js èªè¨¼ã‚·ã‚¹ãƒ†ãƒ  ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå±¤                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚   Browser   â”‚     â”‚    curl     â”‚     â”‚  PowerShell â”‚            â”‚
â”‚  â”‚             â”‚     â”‚             â”‚     â”‚             â”‚            â”‚
â”‚  â”‚ localStorageâ”‚     â”‚ $TOKENå¤‰æ•°   â”‚     â”‚ $tokenå¤‰æ•°  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚         â”‚                   â”‚                   â”‚                   â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                             â”‚                                       â”‚
â”‚                        HTTP Request                                 â”‚
â”‚                    Authorization: Bearer <JWT>                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
```
---
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Express.js ã‚µãƒ¼ãƒãƒ¼                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                      ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å±¤                            â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â‘  helmet (ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼)                                â”‚   â”‚
â”‚  â”‚       â†“                                                      â”‚   â”‚
â”‚  â”‚  â‘¡ cors (CORSè¨­å®š)                                           â”‚   â”‚
â”‚  â”‚       â†“                                                      â”‚   â”‚
â”‚  â”‚  â‘¢ express.json() (JSONãƒ‘ãƒ¼ã‚¹)                                â”‚   â”‚
â”‚  â”‚       â†“                                                      â”‚   â”‚
â”‚  â”‚  â‘£ authenticateToken (JWTæ¤œè¨¼) â†â”€â”€ ä¿è­·ã•ã‚ŒãŸãƒ«ãƒ¼ãƒˆã®ã¿          â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                              â”‚                                       â”‚
â”‚                              â–¼                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚                       ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å±¤                          â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚                                                             â”‚     â”‚
â”‚  â”‚  /api/auth          /api/users          /api/posts          â”‚     â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚     â”‚
â”‚  â”‚  â”‚   auth.js   â”‚   â”‚  users.js   â”‚   â”‚  posts.js   â”‚        â”‚     â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚     â”‚
â”‚  â”‚  â”‚ POST /signupâ”‚   â”‚ GET /me  ğŸ”’ â”‚   â”‚ GET /       â”‚        â”‚      â”‚
â”‚  â”‚  â”‚ POST /login â”‚   â”‚ PUT /me  ğŸ”’ â”‚   â”‚ POST /  ğŸ”’  â”‚         â”‚     â”‚
â”‚  â”‚  â”‚ GET /verify â”‚   â”‚ GET /:id    â”‚   â”‚ DELETE/ ğŸ”’ â”‚          â”‚    â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â”‚         â”‚                   â”‚                 â”‚               â”‚   â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚  â”‚                             â”‚                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                â”‚                                     â”‚
â”‚                                â–¼                                     â”‚
```
---
```
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å±¤                        â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚   â”‚
â”‚  â”‚  â”‚  bcrypt    â”‚  â”‚    JWT     â”‚  â”‚ validator  â”‚               â”‚   â”‚
â”‚  â”‚  â”‚            â”‚  â”‚            â”‚  â”‚            â”‚               â”‚   â”‚
â”‚  â”‚  â”‚ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰   â”‚  â”‚  ãƒˆãƒ¼ã‚¯ãƒ³   â”‚  â”‚ å…¥åŠ›æ¤œè¨¼     â”‚              â”‚   â”‚
â”‚  â”‚  â”‚ ãƒãƒƒã‚·ãƒ¥åŒ–   â”‚  â”‚  ç”Ÿæˆ/æ¤œè¨¼  â”‚  â”‚            â”‚               â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚   â”‚
â”‚  â”‚                                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                â”‚                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
```

---

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å±¤                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                      SQLite Database                         â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”‚
â”‚  â”‚  â”‚   users table   â”‚         â”‚   posts table   â”‚             â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚   â”‚
â”‚  â”‚  â”‚ id              â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚ user_id (FK)    â”‚             â”‚   â”‚
â”‚  â”‚  â”‚ user_id         â”‚         â”‚ id              â”‚             â”‚   â”‚
â”‚  â”‚  â”‚ email           â”‚         â”‚ latitude        â”‚             â”‚   â”‚
â”‚  â”‚  â”‚ password_hash   â”‚         â”‚ longitude       â”‚             â”‚   â”‚
â”‚  â”‚  â”‚ created_at      â”‚         â”‚ comment         â”‚             â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ image_path      â”‚             â”‚   â”‚
â”‚  â”‚                              â”‚ created_at      â”‚             â”‚   â”‚
â”‚  â”‚                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

*å¼·ãMVCã«ä¹—ã£å–ã‚‹ã“ã¨ã‚ˆã‚Šã‚‚ã€ã©ã“ã«ã©ã®å½¹å‰²ãŒã‚ã‚‹ã®ã‹ã‚’æ„è­˜ã™ã‚‹æ–¹ãŒå¤§åˆ‡*


---

## RESTAPIã¨ã¯ãªã«ã‹ï¼Ÿ

### RESTã®åŸºæœ¬åŸå‰‡

* ãƒªã‚½ãƒ¼ã‚¹æŒ‡å‘ - ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚„æ©Ÿèƒ½ã‚’ã€Œãƒªã‚½ãƒ¼ã‚¹ã€ã¨ã—ã¦æ‰±ã„ã€ä¸€æ„ã®URIï¼ˆURLï¼‰ã§è­˜åˆ¥
* çµ±ä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ - HTTPãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆGETã€POSTã€PUTã€DELETEç­‰ï¼‰ã‚’ä½¿ã£ãŸä¸€è²«ã—ãŸæ“ä½œ
* ã‚¹ãƒ†ãƒ¼ãƒˆãƒ¬ã‚¹ - å„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ç‹¬ç«‹ã—ã¦ãŠã‚Šã€ã‚µãƒ¼ãƒãƒ¼å´ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³æƒ…å ±ã‚’ä¿æŒã—ãªã„
* ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ»ã‚µãƒ¼ãƒãƒ¼åˆ†é›¢ - UIã¨ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®é–¢å¿ƒã‚’åˆ†é›¢

### ä¸Šè¨˜ã®åŸå‰‡ã‚’æº€ãŸã™ãŸã‚ã®æ§˜ã€…ãªæ çµ„ã¿

* é©åˆ‡ãªHTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã®ä½¿ç”¨ï¼ˆ200 OKã€404 Not Foundç­‰ï¼‰
* ãƒªã‚½ãƒ¼ã‚¹ã®è¡¨ç¾ã«JSON/XMLã‚’ä½¿ç”¨
* URLã¯åè©ã§æ§‹æˆï¼ˆ/usersã€/productsï¼‰
* æ“ä½œã¯å‹•è©ï¼ˆHTTPãƒ¡ã‚½ãƒƒãƒ‰ï¼‰ã§è¡¨ç¾


---

## OpenAPIã¨ã¯ï¼Ÿ

### OpenAPIè¦æ ¼ã«ã¤ã„ã¦
OpenAPIï¼ˆæ—§ç§°ï¼šSwaggerï¼‰ã¯ã€REST APIã‚’è¨˜è¿°ã™ã‚‹ãŸã‚ã®æ¨™æº–ä»•æ§˜ã§ã™ã€‚
APIã®è¨­è¨ˆã€æ–‡æ›¸åŒ–ã€ãƒ†ã‚¹ãƒˆã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ç”Ÿæˆãªã©ã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚
OpenAPIã®ä¸»ãªç‰¹å¾´

è¨€èªéä¾å­˜ - YAML/JSONã§è¨˜è¿°ã—ã€ã‚ã‚‰ã‚†ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã§åˆ©ç”¨å¯èƒ½
æ©Ÿæ¢°å¯èª­ - è‡ªå‹•çš„ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
æ¨™æº–åŒ– - OpenAPI Initiativeï¼ˆOAIï¼‰ã«ã‚ˆã‚Šç®¡ç†ã•ã‚Œã‚‹å…¬å¼ä»•æ§˜
ãƒãƒ¼ã‚¸ãƒ§ãƒ³ - ç¾åœ¨ã®ä¸»æµã¯OpenAPI 3.0/3.1


---

OpenAPI yamlã®ä¾‹
```yml
openapi: 3.0.3
info:
  title: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†API
  description: ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ç®¡ç†ã™ã‚‹ãŸã‚ã®REST API
  version: 1.0.0
  
servers:
  - url: https://api.example.com/v1
    description: æœ¬ç•ªç’°å¢ƒ
  - url: http://localhost:8080/v1
    description: é–‹ç™ºç’°å¢ƒ

paths:
  /users:
    get:
      summary: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—
      description: ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¸€è¦§ã‚’å–å¾—ã—ã¾ã™
      operationId: getUsers
      parameters:
        - name: limit
          in: query
          description: å–å¾—ä»¶æ•°ã®ä¸Šé™
          required: false
          schema:
            type: integer
            default: 20
            maximum: 100
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '500':
          description: ã‚µãƒ¼ãƒãƒ¼ã‚¨ãƒ©ãƒ¼
          
    post:
      summary: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
      description: æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œæˆã—ã¾ã™
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserInput'
      responses:
        '201':
          description: ä½œæˆæˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: ä¸æ­£ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆ
          
  /users/{userId}:
    get:
      summary: ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°å–å¾—
      description: æŒ‡å®šã•ã‚ŒãŸIDã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã—ã¾ã™
      operationId: getUserById
      parameters:
        - name: userId
          in: path
          description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“
          
    put:
      summary: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°
      description: æŒ‡å®šã•ã‚ŒãŸIDã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’æ›´æ–°ã—ã¾ã™
      operationId: updateUser
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserInput'
      responses:
        '200':
          description: æ›´æ–°æˆåŠŸ
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“
          
    delete:
      summary: ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤
      description: æŒ‡å®šã•ã‚ŒãŸIDã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã™
      operationId: deleteUser
      parameters:
        - name: userId
          in: path
          required: true
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: å‰Šé™¤æˆåŠŸ
        '404':
          description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“

components:
  schemas:
    User:
      type: object
      required:
        - id
        - name
        - email
      properties:
        id:
          type: string
          format: uuid
          description: ãƒ¦ãƒ¼ã‚¶ãƒ¼ID
          example: "550e8400-e29b-41d4-a716-446655440000"
        name:
          type: string
          description: ãƒ¦ãƒ¼ã‚¶ãƒ¼å
          example: "å±±ç”°å¤ªéƒ"
        email:
          type: string
          format: email
          description: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
          example: "yamada@example.com"
        createdAt:
          type: string
          format: date-time
          description: ä½œæˆæ—¥æ™‚
          example: "2024-01-01T09:00:00Z"
        updatedAt:
          type: string
          format: date-time
          description: æ›´æ–°æ—¥æ™‚
          example: "2024-01-15T14:30:00Z"
          
    UserInput:
      type: object
      required:
        - name
        - email
      properties:
        name:
          type: string
          description: ãƒ¦ãƒ¼ã‚¶ãƒ¼å
          minLength: 1
          maxLength: 100
        email:
          type: string
          format: email
          description: ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
```


---


## æ¬¡å›ã«å‘ã‘ã¦ã®ãƒ¯ãƒ¼ã‚¯

# å®Ÿéš›ã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã‚ã†ï¼ï¼

ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å¯å¦ã¯å•ã„ã¾ã›ã‚“ã€‚ã¿ãªã•ã‚“ãŒä½œã£ãŸã‚‚ã®ã‚’è¬›è©•ã—ã¦ã„ãã¾ã™ã€‚
è³ªå•ã¯éšæ™‚å—ã‘ä»˜ã‘ã¾ã™ã€‚

LLMã‚’ã¤ã‹ã£ã¦ã‚‚OKã§ã€ãã®éš›ã¯ã©ã‚“ãªã‚„ã‚Šå–ã‚Šã‚’ã—ãŸã‹ã‚’Markdownãªã©ã«ã¾ã¨ã‚ã¦ãã ã•ã„ã€‚


---

äºˆå‘Šã‚’ã—ã¦ãŠãã¨ã€Dockerå½¢å¼ã ã¨ã•ãã‚‰ã®ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¸ã‚¹ãƒˆãƒªãŒè©¦ã—ã‚„ã™ã„ã®ã§ã€ã“ã¡ã‚‰ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ–¹æ³•ã‚’ç°¡å˜ã«ãŠè¦‹ã›ã—ã¾ã™ã€‚

---

[AppRun Î²ç‰ˆ | ã•ãã‚‰ã®ã‚¯ãƒ©ã‚¦ãƒ‰ ãƒãƒ‹ãƒ¥ã‚¢ãƒ«](https://manual.sakura.ad.jp/cloud/manual-sakura-apprun.html)

[ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¸ã‚¹ãƒˆãƒª | ã•ãã‚‰ã®ã‚¯ãƒ©ã‚¦ãƒ‰ ãƒãƒ‹ãƒ¥ã‚¢ãƒ«](https://manual.sakura.ad.jp/cloud/appliance/container-registry/index.html)


---

ã‚³ãƒ³ãƒ†ãƒŠä½œæˆã®æ‰‹é †(ã•ãã‚‰ã®AppRunç·¨)

1. ã•ãã‚‰ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ
2. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚ˆã‚Šã•ãã‚‰ã®AppRunã«ç§»å‹•ã™ã‚‹ (ãƒ›ãƒ¼ãƒ  > [AppRun](https://secure.sakura.ad.jp/apprun/applications) )
3. ã€Œã•ãã‚‰ã®ã‚¯ãƒ©ã‚¦ãƒ‰ã€ãƒšãƒ¼ã‚¸(ãƒ›ãƒ¼ãƒ ã‚ˆã‚Šä¸€æ®µä¸‹ã£ãŸãƒšãƒ¼ã‚¸)ã®ã‚°ãƒ­ãƒ¼ãƒãƒ« > ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¸ã‚¹ãƒˆãƒª ã§ã‚³ãƒ³ãƒ†ãƒŠã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ç™»éŒ²
4. AppRunå´ã‹ã‚‰ã‚³ãƒ³ãƒ†ãƒŠãƒ¬ã‚¸ã‚¹ãƒˆãƒªã«ç™»éŒ²ã—ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’é¸æŠã—ã¦ã€èµ·å‹•ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠã®è¨­å®šã‚’è¡Œã†


---


(ã‚¯ãƒ©ã‚¦ãƒ‰ã®åˆ©ç”¨æ­´ã®è³ªå•ã‚’è¡Œã†)

AWS / Google Cloud / Azure

ã‚µãƒ¼ãƒãƒ¬ã‚¹ã¨ã¯ãªã«ã‹èª¬æ˜ã§ãã‚‹ã‹

ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ / VPSã‚’é©åˆ‡ã«åˆ©ç”¨ã§ãã‚‹ã‹

ç’°å¢ƒæ§‹ç¯‰ã‚’IaCã§è¡Œãˆã‚‹ã‹


---

## ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã«ã¤ã„ã¦

* Figma
* Canva
* tldraw.io



---

## OpenAPIã«ã¤ã„ã¦

---

## æ¨™æº–çš„ãªé–‹ç™ºãƒ•ãƒ­ãƒ¼

```
1. APIè¨­è¨ˆï¼ˆOpenAPIä»•æ§˜æ›¸ä½œæˆï¼‰
        â†“
2. ä»•æ§˜æ›¸ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»æ‰¿èª
        â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“                       â†“
3. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è‡ªå‹•ç”Ÿæˆ    3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è‡ªå‹•ç”Ÿæˆ
    â†“                       â†“
4. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…    4. UIå®Ÿè£…
    â†“                       â†“
5. è‡ªå‹•ãƒ†ã‚¹ãƒˆ             5. è‡ªå‹•ãƒ†ã‚¹ãƒˆ
    â†“                       â†“
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
6. çµ±åˆãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤
```


---

Node.jsã¨Reactã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä¾‹ã§ã€DBã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰APIä»•æ§˜æ›¸ã‚’ä½œã£ã¦é–‹ç™ºã‚’é€²ã‚ã‚‹ä¾‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ              â”‚
â”‚                  (ERD/Prisma Schema)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              2. OpenAPIä»•æ§˜æ›¸ç”Ÿæˆ                â”‚
â”‚            (DBæ§‹é€ ã‹ã‚‰è‡ªå‹•ç”Ÿæˆ)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â†“                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3A. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰   â”‚       â”‚ 3B. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ â”‚
â”‚    è‡ªå‹•ç”Ÿæˆ        â”‚       â”‚    è‡ªå‹•ç”Ÿæˆ        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4A. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯â”‚       â”‚ 4B. UI/UXå®Ÿè£…     â”‚
â”‚    å®Ÿè£…            â”‚       â”‚    Reacté–‹ç™º       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


---

```
my-app/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â””â”€â”€ schema.prisma
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ generated/      # è‡ªå‹•ç”Ÿæˆã‚³ãƒ¼ãƒ‰
â”‚   â”‚   â”œâ”€â”€ services/       # ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/           # è‡ªå‹•ç”ŸæˆAPIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â””â”€â”€ App.tsx
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ openapi/
â”‚   â””â”€â”€ api-spec.yaml      # è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹OpenAPIä»•æ§˜
â””â”€â”€ package.json           # ãƒ¢ãƒãƒ¬ãƒç®¡ç†
```

ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ ã“ã‚“ãªæ„Ÿã˜ï¼Ÿ

---

## ã‚·ãƒ³ã‚°ãƒ«ãƒšãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã¤ã„ã¦

### ãƒãƒ«ãƒãƒšãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ â†’ ã‚µãƒ¼ãƒãƒ¼ã¸ãƒªã‚¯ã‚¨ã‚¹ãƒˆ â†’ HTMLãƒšãƒ¼ã‚¸å…¨ä½“ã‚’è¿”ã™ â†’ ãƒšãƒ¼ã‚¸å…¨ä½“ã‚’å†æç”»
### ã‚·ãƒ³ã‚°ãƒ«ãƒšãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³s
ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ â†’ JavaScriptãŒå‡¦ç† â†’ å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã®ã¿ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å–å¾— â†’ ç”»é¢ã®ä¸€éƒ¨ã‚’æ›´æ–°

## SPAã®ä¸»ãªç‰¹å¾´

### åˆå›èª­ã¿è¾¼ã¿æ™‚
HTMLã€CSSã€JavaScriptã‚’ä¸€åº¦ã«èª­ã¿è¾¼ã‚€
ãã®å¾Œã¯ãƒ‡ãƒ¼ã‚¿ï¼ˆJSONï¼‰ã®ã‚„ã‚Šå–ã‚Šã®ã¿

### ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
URLã®å¤‰æ›´ã‚’JavaScriptã§åˆ¶å¾¡
ãƒšãƒ¼ã‚¸é·ç§»ã—ã¦ã‚‚ã‚µãƒ¼ãƒãƒ¼ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ç™ºç”Ÿã—ãªã„

### çŠ¶æ…‹ç®¡ç†
ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ä¿æŒ
Reduxã€Vuexã€Recoilãªã©ã®çŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨


---

## ä¸‰å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®å®Ÿè·µä¾‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Nginx     â”‚ â† Webã‚µãƒ¼ãƒãƒ¼
                    â”‚  (Port 80)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â†“              â†“              â†“
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Node.js    â”‚ â”‚  Node.js    â”‚ â”‚  Node.js    â”‚ â† APã‚µãƒ¼ãƒãƒ¼
     â”‚ (Port 3001) â”‚ â”‚ (Port 3002) â”‚ â”‚ (Port 3003) â”‚   (è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹)
     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  PostgreSQL â”‚ â† ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```


---


ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆã¨ãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆ

```conf
# nginx.conf ã¾ãŸã¯ siteè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

location /admin {
    # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§å…¨ã¦æ‹’å¦
    deny all;
    
    # è¨±å¯ã™ã‚‹IPã‚’æ˜ç¤ºçš„ã«æŒ‡å®š
    allow 192.168.1.100;
    allow 192.168.1.101;
    allow 10.0.0.0/24;      # ã‚µãƒ–ãƒãƒƒãƒˆæŒ‡å®šã‚‚å¯èƒ½
    allow 2001:db8::/32;    # IPv6ã‚‚å¯¾å¿œ
}
```

```conf
location / {
    # æ‹’å¦ã™ã‚‹IPã‚’æŒ‡å®š
    deny 192.168.1.50;
    deny 10.10.10.0/24;
    deny 2001:db8:bad::/48;
    
    # ãã‚Œä»¥å¤–ã¯å…¨ã¦è¨±å¯
    allow all;
}
```





---


## TLSã«ã¤ã„ã¦

TLSé€šä¿¡ã®ä»•çµ„ã¿ã¨å®Ÿè·µ
TLSãƒãƒ³ãƒ‰ã‚·ã‚§ã‚¤ã‚¯ã®æµã‚Œï¼š

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆâ†’ã‚µãƒ¼ãƒãƒ¼ï¼šå¯¾å¿œã™ã‚‹æš—å·åŒ–æ–¹å¼ã‚’æç¤º
ã‚µãƒ¼ãƒãƒ¼â†’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼šè¨¼æ˜æ›¸ã¨é¸æŠã—ãŸæš—å·åŒ–æ–¹å¼ã‚’è¿”ç­”
ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼šè¨¼æ˜æ›¸ã‚’æ¤œè¨¼ã—ã€å…±é€šéµã‚’ç”Ÿæˆãƒ»æš—å·åŒ–ã—ã¦é€ä¿¡
ä»¥é™ã€å…±é€šéµã§æš—å·åŒ–é€šä¿¡


### Let's Encryptã§ç„¡æ–™è¨¼æ˜æ›¸å–å¾—ï¼š
```bash
certbot --nginx -d example.com
TLSã¯ã€å…¬é–‹éµæš—å·ã§éµäº¤æ›ã‚’è¡Œã„ã€ãã®å¾Œã¯é«˜é€Ÿãªå…±é€šéµæš—å·ã§å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’æš—å·åŒ–ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç›—è´ãƒ»æ”¹ã–ã‚“ãƒ»ãªã‚Šã™ã¾ã—ã‚’é˜²ãã€å®‰å…¨ãªé€šä¿¡ã‚’å®Ÿç¾ã—ã¾ã™ã€‚è¨¼æ˜æ›¸ã¯èªè¨¼å±€ï¼ˆCAï¼‰ãŒç™ºè¡Œã—ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒæ¤œè¨¼ã™ã‚‹ã“ã¨ã§ã€é€šä¿¡ç›¸æ‰‹ã®æ­£å½“æ€§ã‚’ä¿è¨¼ã—ã¾ã™ã€‚

```


---


## ä»Šé€±ã®å®Ÿé¨“

GPS / GNSS ãƒ­ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã—ã‚ˆã†

GPSãƒ‡ãƒ¼ã‚¿ (åœ°ç†ç©ºé–“ä¸Šã®æ™‚ç³»åˆ—ãƒ‡ãƒ¼ã‚¿)ã¯æ¦‚ã­kmlãªã©ãŒä½¿ã‚ã‚Œã¦ãã¾ã—ãŸãŒã€æœ€è¿‘ã¯GPXãŒæ¯ã‚Œã¦ãã¦åˆ©ç”¨ã—ã‚„ã™ã„ã‹ã‚‚ã€‚

GeoPackage ã‚„ Shapefileã‚‚ã‚‚ã¡ã‚ã‚“ä½¿ã‚ã‚Œã¦ãã¾ã—ãŸã€‚
ã“ã‚Œã‹ã‚‰åˆ©ç”¨ã—ã‚„ã™ããªã‚‹ã§ã‚ã‚ã†å½¢å¼ã¯GeoParquetã§ã™ã€‚

---
GPXã®ä¾‹ (åŸºæœ¬çš„ã«ã¯XMLã¨ã—ã¦è§£æãŒå¯èƒ½ã§ã™)

```xml
<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="GPSã‚¢ãƒ—ãƒªå">
  <!-- ã‚¦ã‚§ã‚¤ãƒã‚¤ãƒ³ãƒˆ -->
  <wpt lat="35.6580" lon="139.7454">
    <ele>634</ele>
    <time>2024-01-01T10:30:00Z</time>
    <name>æ±äº¬ã‚¿ãƒ¯ãƒ¼</name>
  </wpt>
  
  <!-- ãƒˆãƒ©ãƒƒã‚¯ -->
  <trk>
    <name>æœã®ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°</name>
    <trkseg>
      <trkpt lat="35.6595" lon="139.7466">
        <ele>45.2</ele>
        <time>2024-01-01T06:00:00Z</time>
      </trkpt>
      <trkpt lat="35.6596" lon="139.7467">
        <ele>45.5</ele>
        <time>2024-01-01T06:00:05Z</time>
      </trkpt>
      <!-- ç¶šã... -->
    </trkseg>
  </trk>
</gpx>
```
---

# ä»Šé€±ã®ã‚³ãƒ©ãƒ 

---

## èƒŒæ™¯ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«æ¬²ã—ã„åœ°ç‰©ãŒå…¥ã£ã¦ã„ãªã„ï¼Ÿï¼Ÿ

OpenStreetMapã«ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã—ã¾ã—ã‚‡ã†ï¼ (â–¶ï¸ ãƒ‡ãƒ¢ãƒ³ã‚¹ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³)

ãƒ™ã‚¯ã‚¿ãƒ¼ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã¯æ¯é€±æœˆæ›œæ—¥ã«ç·¨é›†å·®åˆ†ãŒå¸åã•ã‚Œã¾ã™ã€‚

---



## ãã®ä»–

ã‚³ãƒãƒ³ãƒ‰ã®å¤‰æ›ãªã©ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§ã™ã‚‹éš›ã«ã€AIã‚¢ã‚·ã‚¹ãƒˆã‚’å—ã‘ã‚‹ã¨ä¾¿åˆ©ã‹ã¨æ€ã„ã¾ã™ã€‚
https://duck.ai/


---

`.gitignore`

```sh
node_modules/
.env
.DS_Store
*.log
/db/*.db
/uploads/*
!/uploads/.gitkeep
```


---

ãŠã™ã™ã‚ã®`.gitignore`ã®è¨­å®šã„ã‚ã„ã‚

```sh

# Node.js
node_modules/
npm-debug.log*
yarn-debug.log*
yarn-error.log*
lerna-debug.log*
.npm

# ç’°å¢ƒå¤‰æ•°
.env
.env.local
.env.development.local
.env.test.local
.env.production.local

# ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«
logs/
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
/db/*.db
/db/*.sqlite
/db/*.sqlite3
*.db-journal

# ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«
/uploads/*
!/uploads/.gitkeep

# OSç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ«
.DS_Store
.DS_Store?
._*
.Spotlight-V100
.Trashes
ehthumbs.db
Thumbs.db

# IDEã¨ã‚¨ãƒ‡ã‚£ã‚¿
.idea/
.vscode/
*.swp
*.swo
*~
.project
.classpath
.c9/
*.launch
.settings/
*.sublime-workspace

# ãƒ“ãƒ«ãƒ‰å‡ºåŠ›
dist/
build/
out/
.cache/

# ãƒ†ã‚¹ãƒˆé–¢é€£
coverage/
.nyc_output/
*.lcov

# TypeScript
*.tsbuildinfo

# ãã®ä»–
.eslintcache
.stylelintcache
*.pid
*.seed
*.pid.lock
.grunt
bower_components
.lock-wscript

# macOS
.AppleDouble
.LSOverride
Icon
*.icloud

# Windows
Thumbs.db
ehthumbs.db
ehthumbs_vista.db
*.stackdump
[Dd]esktop.ini
$RECYCLE.BIN/
*.cab
*.msi
*.msix
*.msm
*.msp
*.lnk

# Linux
*~
.fuse_hidden*
.directory
.Trash-*
.nfs*

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«
*.bak
*.backup
*.old
*.orig
*.tmp
*.temp

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰
/public/uploads/
/temp/
/tmp/
.cache/

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
*.pem
*.key
*.cert
*.crt
*.p12
*.pfx

# ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«
*.7z
*.dmg
*.gz
*.iso
*.jar
*.rar
*.tar
*.zip

# é–‹ç™ºç”¨ãƒ¡ãƒ¢ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
TODO.md
NOTES.md
scratch/
```